# AI法律助手 - 产品需求文档 (PRD)

## 📋 文档信息

**产品名称**: AI法律助手 - Legal Workspace  
**版本**: v3.3  
**文档类型**: 产品需求文档 (Product Requirements Document)  
**最后更新**: 2025-12-16  
**文档状态**: 正式版

---

## 目录

1. [产品概述](#产品概述)
2. [核心功能需求](#核心功能需求)
3. [数据模型与字段定义](#数据模型与字段定义)
4. [技术架构](#技术架构)
5. [开发计划](#开发计划)

---

## 产品概述

### 产品定位
AI法律助手是一个现代化、智能化的法律案件管理系统，为律师和法务人员提供全方位的案件管理和AI辅助功能。

### 目标用户
- 律师事务所律师
- 企业法务人员
- 法律服务机构

### 核心价值
- **效率提升**: 自动化案件信息管理，减少重复劳动
- **智能辅助**: AI驱动的分析和建议，提升决策质量
- **数据可视化**: 直观展示案件关系和时间线
- **知识管理**: 法律研究和案例检索一体化

---

## 核心功能需求

### 1. 用户认证与管理

#### 1.1 用户登录
**功能描述**: 用户通过邮箱和密码登录系统

**交互流程**:
1. 用户输入邮箱和密码
2. 点击"登录"按钮提交
3. 系统验证凭据
4. 登录成功后跳转到案件列表

**验证规则**:
- 邮箱格式验证
- 密码长度验证（最小6位）

**技术实现**:
- 使用 Supabase Authentication 服务
- 全局认证状态管理 (`authStore.js`)
- `onAuthStateChange` 监听认证事件
- 自动重定向未认证用户到登录页

#### 1.2 用户注册
**功能描述**: 新用户通过邮箱注册账号

**交互流程**:
1. 用户输入邮箱、密码、确认密码
2. 点击"注册"按钮
3. 系统创建账号并发送验证邮件
4. 用户验证邮箱后自动登录

**验证规则**:
- 邮箱格式验证
- 密码强度验证
- 两次密码一致性验证

#### 1.3 忘记密码
**功能描述**: 用户可以通过邮箱重置密码

**交互流程**:
1. 点击登录页"忘记密码？"链接
2. 输入注册邮箱
3. 点击"发送重置链接"
4. 系统发送密码重置邮件
5. 用户通过邮件链接重置密码

**技术实现**:
- 调用 `authService.resetPassword(email)`
- Supabase 发送重置邮件

#### 1.4 用户登出
**功能描述**: 用户可以安全登出系统

**交互流程**:
1. 点击侧边栏底部用户头像
2. 在弹出菜单中点击"退出登录"
3. 系统清除认证状态
4. 自动跳转到登录页

**技术实现**:
- 调用 `authService.signOut()`
- `onAuthStateChange` 监听 `SIGNED_OUT` 事件

#### 1.5 个人资料管理
**功能描述**: 用户可以查看和编辑个人信息

**可编辑字段**:
- **基本信息**: 姓名、职位、邮箱、手机号码、所属部门、办公地点、个人简介
- **账号安全**: 当前密码、新密码、确认新密码
- **偏好设置**: 邮件通知、短信通知、语言、主题

**交互流程**:
1. 左侧显示个人资料卡片（头像、姓名、职位）
2. 右侧分标签页展示不同设置
3. 点击"编辑"按钮进入编辑模式
4. 修改后点击"保存"提交更改
5. 显示成功提示

---

### 2. 案件管理

#### 2.1 案件列表

##### 2.1.1 案件列表展示
**功能描述**: 以表格形式展示所有案件

**显示字段**:
- 案件名称（主标题）
- 案件编号
- 客户名称
- 案件类型
- 状态标签（进行中、草稿、已结案）
- 负责人
- 最后更新时间

**交互方式**:
- 点击案件行跳转到案件详情页
- 悬停行高亮显示

**操作功能**:
- 查看详情
- 编辑案件
- 结案（仅进行中案件）
- 删除案件

##### 2.1.2 案件搜索
**功能描述**: 实时搜索案件

**搜索范围**:
- 案件名称
- 案件编号
- 客户名称

**交互方式**:
- 在搜索框输入关键词
- 实时过滤显示匹配结果
- 清空搜索框恢复全部显示

##### 2.1.3 新建案件
**功能描述**: 通过表单创建新案件

**交互流程**:
1. 点击"新建案件"按钮打开表单
2. 填写5个部分的案件信息
3. 点击"保存"存为草稿状态
4. 点击"提交"设为进行中状态

**表单分区**:
1. 基础信息
2. 当事人信息
3. 案情描述
4. 财务信息
5. 联络人信息

**底部操作**:
- 取消: 关闭表单
- 保存: 保存为草稿状态
- 提交: 保存为进行中状态

##### 2.1.4 结案操作
**功能描述**: 将进行中的案件标记为已结案

**交互流程**:
1. 点击案件列表操作栏的结案图标（仅进行中案件显示）
2. 系统弹出确认对话框
3. 确认后案件状态变为"已结案"
4. 已结案案件只读，不可修改

**业务规则**:
- 只有进行中的案件可以结案
- 结案需要二次确认
- 已结案案件不可编辑

#### 2.2 案件表单（新建/编辑）

##### 2.2.1 基础信息
**可编辑字段**:

| 字段名称 | 字段类型 | 是否必填 | 说明 |
|---------|---------|---------|------|
| 案件名称 | 文本 | 是 | 案件的标题描述 |
| 案件编号 | 文本 | 否 | 系统或手动编号 |
| 案由 | 下拉选择 | 否 | 民事、刑事、行政 |
| 具体案由 | 文本 | 否 | 三级案由详细描述 |
| 案件阶段 | 下拉选择 | 否 | 咨询、立案、一审、二审等 |
| 管辖法院/仲裁委 | 文本 | 否 | 管辖机构名称 |
| 承办法官 | 文本 | 否 | 法官姓名 |
| 立案日期 | 日期选择器 | 否 | 可选字段 |
| 诉讼时效/上诉截止日 | 日期选择器 | 否 | 重要时间节点 |

##### 2.2.2 当事人信息
**功能描述**: 支持添加多个原告、被告和第三人

**原告字段**:
- 姓名/名称（必填）
- 主体类型（个人/公司，必填）
- 身份证号/统一信用代码
- 联系电话
- 地址

**被告字段**:
- 姓名/名称（必填）
- 主体类型（个人/公司，必填）
- 身份证号/统一信用代码
- 法定代表人
- 对方代理律师
- 地址

**第三人字段**:
- 姓名/名称（必填）
- 主体类型（个人/公司，必填）
- 身份证号/统一信用代码
- 地址

**交互方式**:
- 点击"添加原告"/"添加被告"/"添加第三人"按钮新增当事人
- 点击"移除"按钮删除当事人（至少保留一个原告和一个被告）
- 每个当事人独立填写信息

##### 2.2.3 案情描述
**可编辑字段**:

| 字段名称 | 字段类型 | 是否必填 | 说明 |
|---------|---------|---------|------|
| 案情摘要 | 多行文本 | 否 | 案件基本情况描述 |
| 争议焦点 | 文本 | 否 | 逗号分隔的争议点 |
| 客户诉求 | 多行文本 | 否 | 客户的诉讼目标 |

##### 2.2.4 财务信息
**可编辑字段**:

| 字段名称 | 字段类型 | 是否必填 | 说明 |
|---------|---------|---------|------|
| 诉讼标的额 | 数字 | 否 | CNY金额 |
| 律师费报价 | 数字 | 否 | CNY金额 |
| 预估诉讼费 | 数字 | 否 | CNY金额 |
| 计费时长 | 数字 | 否 | 小时数 |

##### 2.2.5 联络人信息
**可编辑字段**:

| 字段名称 | 字段类型 | 是否必填 | 说明 |
|---------|---------|---------|------|
| 姓名 | 文本 | 否 | 联络人姓名 |
| 职位/角色 | 文本 | 否 | 职位或角色描述 |
| 电话 | 文本 | 否 | 联系电话 |
| 邮箱 | 邮箱 | 否 | 电子邮箱地址 |
| 地址 | 文本 | 否 | 联系地址 |

##### 2.2.6 表单验证
**验证规则**:
- 案件名称必填
- 至少一个原告和一个被告
- 邮箱格式验证
- 日期有效性验证

#### 2.3 案件详情页

##### 2.3.1 页面结构
**布局**:
- 顶部: 面包屑导航（案件 > 详情 > [案件编号]）
- 左侧: 标签页导航（固定宽度）
- 右侧: 内容区域（自适应）

**标签页分类**:
1. 基础信息
2. 案情描述
3. 当事人信息
4. 证据管理
   - 证据清单
   - 证据分析规划
5. 财务信息
6. 高级功能（重构为独立模块）
   - AI智能分析 (`refactor/AIAnalysis.js`)
   - AI对话助手 (`refactor/AIAssistant.js`)
   - 关系洞察 (`refactor/RelationshipGraph.js`)
   - 证据时间轴 (`refactor/EvidenceTimeline.js`)
   - 生成报价书 (`refactor/QuoteGenerator.js`)

**交互方式**:
- 点击标签页切换内容
- 当前标签页高亮显示
- 子标签页缩进显示

##### 2.3.2 基础信息标签页
**显示内容**:
- 基础信息卡片: 案件标题、编号、案由、法院、日期等
- 联络人卡片: 头像、姓名、职位、联系方式

**编辑功能**:
- 点击卡片右上角编辑图标打开编辑模态框
- 支持分区编辑（基础信息、联络人分别编辑）

##### 2.3.3 案情描述标签页
**显示内容**:
- 案情摘要（文本段落）
- 争议焦点（标签列表）
- 客户诉求（文本段落）

**编辑功能**:
- 点击卡片右上角编辑图标打开编辑模态框
- 支持多行文本编辑

##### 2.3.4 当事人信息标签页
**显示内容**:
- 原告列表（卡片形式）
- 被告列表（卡片形式）
- 第三人列表（卡片形式）

**每个当事人卡片显示**:
- 主体类型图标（个人/公司）
- 姓名/名称
- 身份证号/统一信用代码
- 联系方式
- 地址
- 法定代表人（公司）
- 对方代理律师（被告）

**编辑功能**:
- 点击"添加"按钮新增当事人
- 点击卡片编辑图标编辑当事人
- 点击删除图标删除当事人

##### 2.3.5 财务信息标签页
**显示内容**:
- 诉讼标的额
- 律师费报价
- 预估诉讼费
- 计费时长

**编辑功能**:
- 点击卡片右上角编辑图标打开编辑模态框

---

### 3. 证据管理

#### 3.1 证据清单

##### 3.1.1 证据列表展示
**功能描述**: 以列表形式展示所有已上传的证据文件

**显示内容**:
- 文件名称
- 文件类型图标
- 文件大小
- 上传时间
- 证据分类标签（合同协议、支付凭证、往来函件、其他证据）
- AI置信度（百分比 + 进度条）

**交互方式**:
- 点击文件名预览文件（规划中）
- 点击分类标签重新分类
- 点击下载图标下载文件（规划中）

##### 3.1.2 证据上传
**功能描述**: 支持拖拽或点击上传多个文件

**支持格式**:
- 文档: PDF, Word, Excel
- 图片: JPG, PNG, GIF
- 其他: 录音、视频等

**交互方式**:
- 点击上传区域选择文件
- 拖拽文件到上传区域
- 显示上传进度
- AI自动识别并分类

#### 3.2 AI证据分析规划

##### 3.2.1 证据完整度评估
**功能描述**: AI评估证据收集的完整程度

**显示内容**:
- 完整度百分比
- 已收集/总数（如: 3/6）
- 已收集证据数量
- 缺失证据数量

##### 3.2.2 证据清单
**功能描述**: AI生成的证据收集清单

**显示内容**:
- 证据名称
- 优先级标签（极高、高、中、低）
- 收集状态（已收集/未收集）
- 证据说明

**交互方式**:
- 点击复选框标记证据收集状态
- 按优先级排序显示

##### 3.2.3 导出证据清单
**功能描述**: 导出证据分析清单为Excel或PDF

**交互方式**:
1. 点击"导出清单"按钮
2. 选择导出格式（Excel/PDF）
3. 下载文件

---

### 4. AI智能功能

#### 4.1 AI智能分析 (AIAnalysis.js)

##### 4.1.1 胜诉率预测
**功能描述**: AI基于案情和证据预测胜诉概率

**显示内容**:
- 胜诉率百分比
- 说明文字"(基于现有证据分析)"
- 可视化进度条

**计算依据**:
- 案件类型
- 证据完整度
- 类似案例判决结果
- 法律法规匹配度

##### 4.1.2 风险点提示
**功能描述**: 智能识别案件中的风险点

**显示内容**:
- 风险点列表
- 每个风险点包含：
  - 风险描述
  - 严重程度（高风险/一般提示）
  - 建议措施

**风险类型**:
- 证据不足风险
- 时效过期风险
- 程序瑕疵风险
- 法律适用风险

##### 4.1.3 AI策略建议
**功能描述**: 提供诉讼策略和证据收集建议

**显示内容**:
- 策略建议文本段落
- 证据收集建议
- 诉讼步骤建议

##### 4.1.4 刷新分析
**功能描述**: 重新生成AI分析报告

**交互方式**:
- 点击"刷新分析"按钮
- 重新计算胜诉率和风险点
- 更新策略建议

#### 4.2 AI对话助手 (AIAssistant.js)

##### 4.2.1 聊天界面
**功能描述**: 基于案件材料的智能问答

**布局**:
- 聊天消息区域（自适应高度）
- 快捷建议区域（仅首次显示）
- 输入区域（固定底部）

**消息类型**:
- AI消息: 左对齐，机器人头像
- 用户消息: 右对齐，用户头像

##### 4.2.2 快捷建议
**功能描述**: 提供常用问题快捷入口

**建议内容**:
- "分析本案的胜诉概率"
- "生成一份证据收集清单"
- "起草一份律师函"
- "查找类似的判决案例"

**交互方式**:
- 点击建议自动发送消息
- 发送后隐藏建议区域

##### 4.2.3 消息输入
**功能描述**: 用户输入和发送消息

**交互方式**:
- 在文本框输入消息
- 按Enter发送
- 按Shift+Enter换行
- 点击"发送"按钮发送

#### 4.3 关系洞察 (RelationshipGraph.js)

##### 4.3.1 关系图谱可视化
**功能描述**: 使用D3.js展示人物和公司关系网络

**显示内容**:
- 节点: 人物（圆形）、公司（方形）
- 连线: 关系类型 + 金额（如有）
- 颜色编码: 不同主体类型不同颜色

**交互方式**:
- 拖拽节点改变位置
- 滚轮缩放图谱
- 点击节点查看详情
- 节点之间自动力导向布局

##### 4.3.2 图例和统计
**功能描述**: 显示图谱说明和统计信息

**显示内容**:
- 图例: 节点颜色含义
- 统计信息:
  - 实体总数
  - 关系总数
  - 涉及金额

##### 4.3.3 刷新图谱
**功能描述**: 重新布局关系图谱

**交互方式**:
- 点击"刷新图谱"按钮
- 重新计算节点位置
- 重新渲染图谱

#### 4.4 证据时间轴 (EvidenceTimeline.js)

##### 4.4.1 时间轴展示
**功能描述**: AI生成的证据相关事件时间线可视化

**显示内容**:
- 时间线（垂直布局）
- 事件节点（圆点）
- 事件信息: 日期、标题、描述、关联证据

**事件状态**:
- 已完成: 绿色圆点
- 进行中: 蓝色圆点
- 待开始: 灰色圆点

##### 4.4.2 时间轴操作
**功能描述**: 刷新、编辑、导出时间轴

**操作功能**:
- **刷新**: 重新生成时间轴
- **编辑**: 进入编辑模式，手动调整事件
- **导出**: 导出为PDF或图片

#### 4.5 生成报价书 (QuoteGenerator.js)

##### 4.5.1 报价书生成
**功能描述**: 基于案件信息自动生成法律服务报价书

**显示内容**:
- 案件基本信息（自动填充）
- 服务项目清单
- 收费标准
- 总计金额

**交互方式**:
1. 点击"生成报价书"按钮
2. 系统自动填充案件信息
3. 可手动调整服务项目和费用
4. 点击"导出PDF"下载报价书

##### 4.5.2 自动填充功能
**功能描述**: 从案件信息自动填充报价书内容

**自动填充字段**:
- 案件名称
- 客户名称
- 案件类型
- 诉讼标的额
- 预估工作量

**计算逻辑**:
- 根据案件类型和标的额计算建议费用
- 根据案件复杂度估算工作时长
- 自动生成服务项目清单

---

### 5. 法律研究

#### 5.1 法律检索

##### 5.1.1 搜索功能
**功能描述**: 搜索法律法规和案例

**交互流程**:
1. 输入关键词
2. 点击搜索按钮或按Enter
3. 实时显示搜索结果

**搜索类型**:
- 案例检索
- 法规检索

##### 5.1.2 筛选功能
**功能描述**: 通过多个条件筛选搜索结果

**案例筛选条件**:
- 关键词
- 法院层级（最高法、高级法院、中级法院、基层法院）
- 地区（全国、北京、上海、广东等）
- 裁判年份（年份范围）
- 审理程序（一审、二审、再审、执行）
- 文书类型（判决书、裁定书、调解书、决定书）

**法规筛选条件**:
- 关键词
- 法规类别（法律、行政法规、司法解释等）
- 发布机关
- 效力级别
- 时效性（有效、失效、部分失效）

**交互方式**:
- 点击"筛选条件"按钮展开/折叠面板
- 选择筛选条件
- 点击"应用筛选"
- 点击"重置"清空条件

##### 5.1.3 搜索结果
**功能描述**: 展示检索结果

**标签页切换**:
- 法规标签页
- 案例标签页

**案例结果显示**:
- 案件名称
- 案号
- 法院
- 裁判日期
- 案由

**法规结果显示**:
- 法规名称
- 发布机关
- 发布日期
- 效力级别

**交互方式**:
- 点击结果项查看详情
- 滚动加载更多

##### 5.1.4 案例详情查看
**功能描述**: 查看完整判决书原文

**显示内容**:
- 案件基本信息
- 当事人信息
- 审理经过
- 事实认定
- 裁判理由
- 裁判结果

**交互方式**:
- 通过模态框展示
- 支持滚动查看
- 支持复制文本

##### 5.1.5 法规详情查看
**功能描述**: 查看法规全文

**显示内容**:
- 法规基本信息
- 法规正文
- 章节导航（右侧）

**交互方式**:
- 通过模态框展示
- 左侧显示正文
- 右侧显示章节导航
- 点击章节快速跳转

#### 5.2 历史记录
**功能描述**: 查看历史检索记录

**显示内容**:
- 检索关键词
- 检索时间
- 检索类型（案例/法规）

**交互方式**:
- 点击"历史记录"按钮打开模态框
- 标签页切换（案例/法规）
- 点击历史记录重新检索

---

### 6. 合同审查

#### 6.1 合同上传
**功能描述**: 上传合同文件进行AI审查

**支持格式**:
- PDF
- Word (DOC, DOCX)

**交互流程**:
1. 点击上传区域或拖拽文件
2. 选择合同类型
3. 点击"开始审查"
4. 系统进行AI分析
5. 跳转到审查结果页

#### 6.2 审查结果
**功能描述**: 展示AI合同审查结果

**显示内容**:
- 合同基本信息
- 风险评分
- 风险点列表（高风险、中风险、低风险）
- 条款建议
- 修改建议

**交互方式**:
- 查看详细风险说明
- 导出审查报告

#### 6.3 历史记录
**功能描述**: 查看历史审查记录

**显示内容**:
- 合同名称
- 审查时间
- 风险评分

**交互方式**:
- 点击历史记录查看详情

---

### 7. 文书生成

#### 7.1 文书类型选择
**功能描述**: 选择要生成的文书类型

**支持类型**:
- 起诉状
- 答辩状
- 报价书

**交互方式**:
- 点击对应文书类型卡片
- 进入文书生成页面

#### 7.2 起诉状生成
**功能描述**: 基于案件信息生成起诉状

**自动填充内容**:
- 原告信息
- 被告信息
- 诉讼请求
- 事实与理由
- 证据清单
- 法律依据

**交互流程**:
1. 选择关联案件
2. 系统自动填充案件信息
3. 可手动编辑内容
4. 预览生成结果
5. 导出为Word或PDF

#### 7.3 答辩状生成
**功能描述**: 基于案件信息生成答辩状

**自动填充内容**:
- 答辩人信息
- 被答辩人信息
- 答辩意见
- 事实与理由
- 证据清单
- 法律依据

**交互流程**:
1. 选择关联案件
2. 系统自动填充案件信息
3. 可手动编辑内容
4. 预览生成结果
5. 导出为Word或PDF

#### 7.4 历史记录
**功能描述**: 查看历史生成记录

**显示内容**:
- 文书类型
- 案件名称
- 生成时间

**交互方式**:
- 标签页切换（起诉状/答辩状）
- 点击历史记录查看详情
- 重新导出文书

---

### 8. 产品反馈

#### 8.1 反馈提交
**功能描述**: 用户提交产品反馈和建议

**反馈分类**:
- 功能建议
- 问题反馈
- 使用体验
- 其他

**反馈字段**:
- 分类（下拉选择）
- 标题（必填）
- 详细描述（必填）
- 优先级（低、中、高）
- 附件（可选）

**交互流程**:
1. 填写反馈表单
2. 点击"提交反馈"
3. 系统保存反馈
4. 显示提交成功提示

#### 8.2 反馈列表
**功能描述**: 查看已提交的反馈

**显示内容**:
- 反馈标题
- 分类
- 状态（待处理、处理中、已完成）
- 提交时间

**交互方式**:
- 点击反馈查看详情
- 筛选不同状态的反馈

---

## 数据模型与字段定义

### 1. 案件基础信息表 (cases)

| 字段名称 | 数据类型 | 字段描述 | AI 应用场景 |
| :--- | :--- | :--- | :--- |
| `id` | UUID | 案件唯一标识符 | 系统索引 |
| `user_id` | UUID | 用户ID（外键） | 用户隔离 |
| `case_title` | String | 案件标题 | 标题生成 |
| `case_number` | String | 案件编号 | 案件检索 |
| `case_type` | String | 案由类型 | 决定AI调用哪个领域的法律库 |
| `legal_cause` | String | 具体案由 | 精准判例匹配 |
| `case_stage` | String | 案件阶段 | 流程自动化提醒 |
| `jurisdiction_court` | String | 管辖法院/仲裁委 | 分析该法院过往判决倾向 |
| `judge_name` | String | 承办法官 | 分析法官画像 |
| `filing_date` | Date | 立案日期 | 计算审限 |
| `statute_deadline` | Date | 诉讼时效/上诉截止日 | 高危风险预警 |
| `status` | String | 案件状态（draft/active/closed） | 状态流转 |
| `created_at` | Timestamp | 创建时间 | 排序 |
| `updated_at` | Timestamp | 更新时间 | 排序 |

---

### 2. 核心事实与案情描述

| 字段名称 | 数据类型 | 字段描述 | AI 应用场景 |
| :--- | :--- | :--- | :--- |
| `fact_summary` | Text | 案情摘要 | 生成起诉状/答辩状的基础 |
| `dispute_focus` | Text | 争议焦点 | 针对性法律检索 |
| `client_objective` | Text | 客户诉求 | 策略制定的目标导向 |

---

### 3. 当事人与关系方 (parties - JSONB字段)

| 字段名称 | 数据类型 | 字段描述 | AI 应用场景 |
| :--- | :--- | :--- | :--- |
| `party_type` | String | 角色（原告/被告/第三人） | 确定文书中的称谓 |
| `entity_type` | String | 主体类型（自然人/法人） | 校验主体资格字段 |
| `name` | String | 姓名/名称 | 文书自动填充 |
| `legal_rep` | String | 法定代表人 | 文书自动填充 |
| `opposing_counsel` | String | 对方代理律师 | 分析对手风格 |

---

### 4. 证据管理与分析 (evidence - 规划中)

| 字段名称 | 数据类型 | 字段描述 | AI 应用场景 |
| :--- | :--- | :--- | :--- |
| `evidence_name` | String | 证据名称 | 证据目录生成 |
| `evidence_type` | String | 证据种类 | 适用不同的质证规则 |
| `file_path` | String | 文件存储路径 | OCR识别内容 |
| `ocr_content` | Text | 证据内容的文本提取 | 关键词搜索 |
| `proof_purpose` | Text | 证明目的 | 自动生成质证意见 |
| `authenticity_score` | Float | 真实性评分（AI预判） | 风险提示 |
| `relevance_score` | Float | 关联性评分（AI预判） | 剔除无效证据 |

---

### 5. 法律研究与AI推理

| 字段名称 | 数据类型 | 字段描述 | AI 应用场景 |
| :--- | :--- | :--- | :--- |
| `matched_laws` | JSON | 匹配的法条 | 法律依据引用 |
| `similar_cases` | Array | 相似类案ID | 类案同判参考 |
| `win_probability` | Percentage | 胜诉率预测 | 客户预期管理 |
| `risk_points` | Array | 风险点提示 | 案件诊断报告 |
| `strategy_suggestion` | Text | AI建议的诉讼策略 | 律师办案思路辅助 |

---

### 6. 财务与标的 (financial - JSONB字段)

| 字段名称 | 数据类型 | 字段描述 |
| :--- | :--- | :--- |
| `claim_amount` | Decimal | 诉讼标的额 |
| `attorney_fee` | Decimal | 律师费报价 |
| `court_cost` | Decimal | 预估诉讼费 |
| `billable_hours` | Float | 计费时长 |

---

### 7. 联络人信息 (contact - JSONB字段)

| 字段名称 | 数据类型 | 字段描述 |
| :--- | :--- | :--- |
| `contact_name` | String | 联络人姓名 |
| `contact_role` | String | 职位/角色 |
| `contact_phone` | String | 联系电话 |
| `contact_email` | String | 电子邮箱 |
| `contact_address` | String | 联系地址 |

---

### 8. 用户资料表 (profiles)

| 字段名称 | 数据类型 | 字段描述 |
| :--- | :--- | :--- |
| `id` | UUID | 主键（关联auth.users） |
| `email` | String | 邮箱 |
| `full_name` | String | 姓名 |
| `avatar_url` | String | 头像URL |
| `title` | String | 职位 |
| `phone` | String | 电话 |
| `department` | String | 所属部门 |
| `office_location` | String | 办公地点 |
| `bio` | Text | 个人简介 |
| `created_at` | Timestamp | 创建时间 |
| `updated_at` | Timestamp | 更新时间 |

---

### 9. 产品反馈表 (product_feedback)

| 字段名称 | 数据类型 | 字段描述 |
| :--- | :--- | :--- |
| `id` | UUID | 主键 |
| `user_id` | UUID | 用户ID |
| `category` | String | 分类 |
| `title` | String | 标题 |
| `description` | Text | 描述 |
| `priority` | String | 优先级 |
| `status` | String | 状态 |
| `created_at` | Timestamp | 创建时间 |

---

## 技术架构

### 前端技术栈
- **框架**: Vue 3 (CDN)
- **路由**: 自定义 Hash 路由
- **样式**: 原生 CSS
- **图标**: Font Awesome 6
- **可视化**: D3.js v7
- **认证**: Supabase Authentication
- **状态管理**: Vue Reactive (`authStore.js`)

### 后端服务
- **认证与数据库**: Supabase (PostgreSQL + Auth)
- **法律检索API**: 通义法睿 API
- **本地存储**: LocalStorage

### 项目结构
```
legal-workspace-vue/
├── index.html                    # 入口文件
├── check-syntax.js               # 语法检查工具
├── assets/
│   └── styles/
│       ├── main.css              # 全局样式
│       ├── brand.css             # 品牌样式
│       └── evidence.css          # 证据相关样式
├── src/
│   ├── main.js                   # 应用入口、认证初始化
│   ├── router.js                 # 路由配置
│   ├── config/
│   │   └── supabase.js           # Supabase 客户端与认证服务
│   ├── store/
│   │   └── authStore.js          # 全局认证状态管理
│   ├── components/               # 组件
│   │   ├── layout/
│   │   │   ├── AppLayout.js      # 主布局
│   │   │   └── Sidebar.js        # 侧边栏
│   │   └── HistoryModal.js       # 历史记录模态框
│   └── views/                    # 页面视图
│       ├── CaseList.js           # 案件列表
│       ├── CaseDetail.js         # 案件详情
│       ├── CaseForm.js           # 案件表单
│       ├── EvidenceUpload.js     # 证据上传
│       ├── LegalResearch.js      # 法律检索
│       ├── CaseSearchResults.js  # 案例检索结果
│       ├── CaseDetailView.js     # 案例详情查看
│       ├── RegulationSearchResults.js # 法规检索结果
│       ├── ContractReview.js     # 合同审查
│       ├── ContractReviewResult.js # 合同审查结果
│       ├── DocGenerate.js        # 文书生成
│       ├── UserProfile.js        # 个人资料
│       ├── Settings.js           # 系统设置
│       ├── ProductFeedback.js    # 产品反馈
│       ├── Login.js              # 登录
│       ├── Register.js           # 注册
│       ├── ForgotPassword.js     # 忘记密码
│       └── refactor/             # 重构的高级功能模块
│           ├── AIAnalysis.js     # AI智能分析
│           ├── AIAssistant.js    # AI对话助手
│           ├── RelationshipGraph.js # 关系洞察
│           ├── EvidenceTimeline.js  # 证据时间轴
│           └── QuoteGenerator.js    # 报价生成器
└── docs/                         # 文档
    ├── PRD.md                    # 产品需求文档（本文档）
    ├── 架构设计文档.md            # 系统架构设计
    ├── design-guidelines.md      # 设计规范
    ├── 前端开发规范.md            # 前端开发规范
    ├── api/                      # API文档
    └── sql/                      # 数据库脚本
```

### 核心组件说明

#### AppLayout.js
- 主应用布局组件
- 包含侧边栏和内容区域
- 响应式布局

#### Sidebar.js
- 侧边栏导航组件
- 可折叠设计
- 用户菜单集成

#### CaseDetail.js
- 案件详情核心页面
- 标签页导航
- 集成重构后的高级功能模块
- 模块化设计，易于维护

#### refactor/ 目录
- **AIAnalysis.js**: AI智能分析模块（胜诉率预测、风险识别、策略建议）
- **AIAssistant.js**: AI对话助手模块（智能问答、快捷建议）
- **RelationshipGraph.js**: 关系洞察模块（D3.js可视化）
- **EvidenceTimeline.js**: 证据时间轴模块（事件时间线）
- **QuoteGenerator.js**: 报价生成器模块（法律服务报价书）

---

## 开发计划

### 核心功能列表 (v3.3)

#### 核心功能
- 用户认证与管理（Supabase Auth）
  - 登录/注册/登出
  - 忘记密码
  - 个人资料管理
- 案件管理
  - 案件列表（展示、搜索、筛选）
  - 案件创建（新建、编辑）
  - 案件详情（多标签页展示）
  - 案件状态流转（草稿 → 进行中 → 已结案）
  - 结案操作（二次确认）
- 分区编辑功能
  - 基础信息编辑
  - 案情描述编辑
  - 当事人信息编辑
  - 财务信息编辑
  - 联络人信息编辑
- 多当事人支持
  - 多个原告
  - 多个被告
  - 多个第三人
- 证据管理
  - 证据上传（拖拽/点击）
  - 证据列表展示
  - AI证据分类
  - 证据完整度评估
  - 证据清单导出
- 法律检索
  - 案例检索（通义法睿API）
  - 法规检索（通义法睿API）
  - 高级筛选
  - 检索结果展示
  - 案例/法规详情查看
  - 历史记录
- 合同审查
  - 合同上传
  - AI审查分析
  - 风险评分
  - 审查结果展示
  - 历史记录
- 文书生成
  - 起诉状生成
  - 答辩状生成
  - 报价书生成
  - 自动填充案件信息
  - 文书导出（Word/PDF）
  - 历史记录
- 产品反馈系统
  - 反馈提交
  - 反馈列表
  - 反馈状态管理

#### 高级功能（已重构为独立模块）
- AI智能分析（`refactor/AIAnalysis.js`）
  - 胜诉率预测
  - 风险点识别
  - 诉讼策略建议
  - 刷新分析功能
- AI对话助手（`refactor/AIAssistant.js`）
  - 智能问答
  - 快捷建议
  - 对话历史
  - 消息输入/发送
- 关系洞察（`refactor/RelationshipGraph.js`）
  - D3.js关系图谱可视化
  - 交互式节点操作（拖拽、缩放）
  - 图例和统计
  - 刷新图谱功能
- 证据时间轴（`refactor/EvidenceTimeline.js`）
  - 事件时间线展示
  - 证据关联显示
  - 刷新、编辑、导出功能
- 报价生成器（`refactor/QuoteGenerator.js`）
  - 自动填充案件信息
  - 服务项目编辑
  - 费用计算
  - PDF导出

### 近期计划 (v3.4)
- 证据时间轴编辑器增强
  - 手动添加/编辑事件
  - 事件排序
  - 证据关联管理
- 文件预览功能
  - PDF预览
  - 图片预览
  - Word预览
- 证据下载功能
  - 单个文件下载
  - 批量下载
  - 打包下载
- 图谱导出功能
  - 导出为图片
  - 导出为PDF
- 路由守卫增强
  - 权限控制
  - 页面访问控制
- 用户资料扩展
  - profiles表完善
  - 更多个人信息字段

### 中期计划 (v4.0)
- 团队协作功能
  - 案件共享
  - 协作编辑
  - 权限分配
- 权限管理系统
  - 角色管理
  - 权限配置
  - 操作日志
- 后端API服务
  - RESTful API
  - API文档
  - API认证
- 数据持久化到Supabase
  - 案件数据同步
  - 证据文件存储
  - 实时数据更新
- 消息通知系统
  - 站内消息
  - 邮件通知
  - 截止日期提醒
- 数据分析看板
  - 案件统计
  - 工作量统计
  - 数据可视化

### 长期规划 (v5.0+)
- 移动端适配
  - 响应式设计优化
  - 移动端专属功能
- 迁移到Vue 3 + Vite构建
  - 构建工具升级
  - 性能优化
  - 开发体验提升
- TypeScript重构
  - 类型安全
  - 代码提示
  - 重构支持
- 微前端架构
  - 模块独立部署
  - 技术栈灵活
  - 团队协作
- GraphQL API
  - 灵活的数据查询
  - 减少网络请求
  - 实时订阅
- 多语言支持
  - 国际化
  - 本地化
- 私有化部署方案
  - Docker部署
  - 本地化部署
  - 数据安全
- 第三方系统集成
  - 法院系统对接
  - 办公系统集成
  - 数据导入导出

---

## 附录

### 功能统计
- **已实现功能**: 80+
- **规划中功能**: 30+
- **页面数量**: 15个
- **核心模块**: 8个
- **重构模块**: 5个

### 版本历史

#### v3.3 (2025-12-15) - 当前版本 ✨
**代码重构与模块化**:
- 高级功能模块化重构
- 将AI分析、AI助手、关系图谱、证据时间轴、报价生成器拆分为独立组件
- 新建 `views/refactor/` 目录存放重构后的模块
- 提升代码可维护性和复用性
- 优化项目结构文档
- 新增架构设计文档

#### v3.2 (2025-12-08)
**用户认证系统**:
- 集成 Supabase Authentication 认证服务
- 新增全局认证状态管理 (`authStore.js`)
- 新增忘记密码功能
- 修复登录重定向循环问题
- 实现正确的登出功能
- 简化路由守卫逻辑

**历史记录功能**:
- 通用历史记录模态框组件
- 法律检索历史（案例/法规标签页）
- 文书生成历史（起诉状/答辩状标签页）
- 合同审查历史
- 按日期倒序排列和筛选

#### v3.1 (2025-12-04)
**案件状态流转优化**:
- 新建案件：保存（草稿）/ 提交（进行中）双按钮
- 结案功能移至案件列表操作栏
- 结案操作二次确认
- 已结案案件只读保护
- 删除详情页状态下拉选择

**布局优化**:
- 基础信息改为两列网格布局
- 联络人信息合并到基础信息卡片
- 删除案件进度卡片
- 案件阶段改为下拉选择（咨询/立案/一审/二审等）

**证据时间轴优化**:
- 添加刷新、编辑、导出按钮
- 按钮样式与关系洞察统一

#### v3.0 (2025-12-04)
- 新增分区编辑模态框
- 新增联络人编辑功能
- 优化AI分析UI
- 增强AI对话助手UI
- 统一保存按钮图标
- 优化文本框边框
- 新增多当事人支持

#### v2.0 (2025-12-03)
- 重构案件详情页
- 新增AI智能分析
- 新增案件时间轴

#### v1.5 (2025-12-02)
- 实现关系洞察可视化
- 优化证据分析界面

---

**文档维护**: Alpha&Leader Legal Tech  
**最后更新**: 2025-12-16  
**文档版本**: v3.3
