# 通义法睿“合同抽取”API 可行性分析

## 1. 业务需求回顾

根据之前的用户反馈和差距分析，核心需求为：

- **智能数据录入**：从上传的合同/文档中自动提取关键信息（如金额、日期、当事人、主要条款）填充到系统表单中，减少人工录入。
- **证据/材料整理**：对庞杂材料进行结构化提取。
- **灵活性**：用户希望系统能适应不同类型的文档，提取不同的字段。

## 2. API 能力分析 (基于 `/pop/contract/extraction`)

该接口允许我们传入一个文档 (OSS URL) 和一个“需要抽取的字段列表”，大模型会返回提取结果及原文依据。

### ✅ 核心优势 (Pros)

1.  **自定义提取 (Flexible)**:
    - 通过 `fieldsToExtract` 参数，我们可以动态定义想抽取的字段（如“合同总金额”、“签署日期”、“违约金比例”）。
    - **支持枚举 (Option)**: 可以限制输出值为固定选项（如“收入/支出”），这非常利于前端下拉框的自动选中。
    - **语义理解 (Desc)**: 可以通过 `desc` 字段给 AI 提供“提示词”，告诉它这个字段的定义，提高准确率。
2.  **可溯源 (Auditability)**:
    - 返回参数包含 `originalText` (原文依据)。这对于法律场景至关重要，用户可以点击字段看到 AI 是根据哪句话提取的，方便人工复核。
3.  **结构化输出**: 直接返回 JSON 格式，易于前端处理。

### ⚠️ 限制与挑战 (Cons)

1.  **字段数量限制**: API 文档明确指出“抽取字段最多 10 个”。
    - _影响_: 如果一个复杂的合同需要提取 20 个字段，可能需要并发调用 2 次接口，增加了成本和延迟。
2.  **文件流转**: 接口参数是 `fileOssUrl`，意味着我们必须先将用户上传的文件转存到公网可访问的 OSS（或有权限的 OSS），而不能直接传二进制流。
3.  **适用范围**: 接口名为“合同抽取”，可能针对合同类文档优化较好。对于非合同类的“证据材料”（如聊天记录、复杂的银行流水），效果需要实测。

## 3. 结论：能否满足业务需求？

**结论：基本满足，且非常适合“智能合同录入”场景。**

### 场景匹配度

| 业务场景                 | 匹配度            | 说明                                                                                               |
| :----------------------- | :---------------- | :------------------------------------------------------------------------------------------------- |
| **合同基本信息自动填充** | ⭐⭐⭐⭐⭐ (完美) | 甲方、乙方、金额、日期等< 10 个核心字段可一次性提取。                                              |
| **自定义字段提取**       | ⭐⭐⭐⭐ (良好)   | 支持用户定义的字段（通过传参实现），但受 10 个字段限制。                                           |
| **证据整理 (非合同)**    | ⭐⭐ (存疑)       | 建议先测试。如果效果一般，证据类可能需要用通用的“文档解析/OCR”+ LLM 总结接口，而不是这个专用接口。 |

## 4. 建议实施方案

为了绕过“最多10个字段”的限制并提升体验，建议采用**“分组提取策略”**：

1.  **前端配置**: 将合同表单分为几个部分（如“基础信息”、“财务条款”、“违约责任”）。
2.  **按需调用**:
    - 或者一次性发起 2-3 个并行请求（Group A: 基础信息, Group B: 财务信息），在后端聚合结果后返回给前端。
3.  **UI 交互**:
    - 用户上传文件 -> 进度条提示“正在解析合同...” -> 表单自动填充。
    - **高亮验证**: 当用户鼠标悬停在自动填充的输入框时，在左侧预览区高亮显示 API 返回的 `originalText`，让用户确认无误。

## 5. 待确认事项

- **私有化/内网 URL 支持**: 确认 `fileOssUrl` 是否支持带签名的临时 URL（以保证合同隐私），还是必须完全公开。（通常支持带签名的 OSS URL）。
- **非 PDF/Docx 支持**: 确认是否支持图片格式（扫描件合同）。

## 6. 关于在线预览与编辑

**特别说明：通义法睿“合同抽取”API 仅返回纯 JSON 数据，不提供任何文档预览或编辑界面。**

要实现“左侧文档/右侧表单”的交互效果，需配合前端组件：

1.  **预览与高亮 (强烈推荐)**：
    - **方案**：使用 `@vue-office/docx`（同合同审查方案）。
    - **交互**：API 返回了 `originalText`（原文片段）。前端可以在 Vue-Office 渲染的 DOM 中查找该文本段落，并添加背景色高亮。这能让用户直观看到“AI 是从哪提取的这个金额”。
2.  **在线编辑原文**：
    - **场景**：通常“合同抽取”阶段用户主要修正的是**提取出来的表单数据**，而非**合同原文**。
    - **实现**：如果确实需要修改合同原文（如发现合同里名字写错了），则需要集成 **Aliyun WebOffice** 或 **WPS WebOffice**（详见《合同审查预览与编辑方案》）。
