# AI 案件可行性报告实现文档

本文档详细说明了Legal Workspace中“AI 可行性报告”模块的实现逻辑、数据结构及核心算法。该模块旨在通过多维度分析，为律师提供明确的诉讼建议。

## 1. 核心设计理念

- **数据驱动结论**：所有的建议（起诉/和解/放弃）都必须基于客观数据的计算，而非随机生成。
- **证据为王**：证据链的完整度是决定胜诉率和策略选择的第一要素。
- **偿债能力兜底**：即便胜诉率高，如果对方无财产可供执行，系统也会给出风险提示（ROI 预警）。

## 2. 7维度分析模型

本报告包含以下7个核心分析维度，数据结构定义在 `feasibilityAnalysis` 对象中：

| 维度              | 字段名 (`key`)        | 描述                              | 数据来源 (当前)           |
| :---------------- | :-------------------- | :-------------------------------- | :------------------------ |
| **1. 案情概要**   | `caseBackground`      | 争议焦点、核心诉求                | 模拟聚合 (CaseBasicInfo)  |
| **2. 事实与证据** | `evidenceGapAnalysis` | 证据链核查、举证责任              | 模拟聚合 (CaseEvidence)   |
| **3. 法律分析**   | `legalAnalysis`       | 管辖、案由、时效、法条 (支持翻页) | AI 推理 (Farui API)       |
| **4. 风险评估**   | `riskAssessment`      | SWOT 分析、胜诉率区间             | AI 综合评估               |
| **5. 执行可行性** | `enforcement`         | 偿债能力、保全建议                | 模拟聚合 (CaseFinancials) |
| **6. 诉讼策略**   | `strategyPlan`        | 核心策略、时间轴、预案            | 规则引擎生成              |
| **7. 成本收益**   | `costBenefit`         | 预估成本、ROI                     | 自动计算                  |

## 3. 核心决策逻辑 (决策树)

系统根据 **证据覆盖率** 和 **偿债能力** 两个核心指标，通过以下决策树生成最终建议：

### 判定指标

1.  **证据覆盖率 (`evidenceRate`)** = 已核实证据数 / 总证据清单数
2.  **偿债能力 (`solvency`)** = 强 / 中等 / 差

### 决策分支

#### ✅ 分支 A：建议起诉 (Litigation)

- **触发条件**：
  - `evidenceRate` ≥ 75%
  - **且** `solvency` ≠ "差"
- **核心逻辑**：核心证据充分且对方具备偿债能力，以胜诉并执行到位为目标。
- **输出策略**：快速推进诉讼，申请保全，准备庭审。
- **适用场景**：胜诉概率大，且回款有保障。

#### ⚠️ 分支 B：建议和解/调解 (Settlement)

- **触发条件**：
  - `evidenceRate` ≥ 40% (证据存在瑕疵，如缺失验收单)
  - **或** `solvency` = "中等" (执行存在风险)
- **核心逻辑**：证据有瑕疵或执行有难度，利用诉讼施压促成谈判，快速回款（即便打折）。
- **输出策略**：以诉促调，起草和解协议，法院调解。
- **适用场景**：硬打官司风险较大，谈判是更优解。

#### ❌ 分支 C：不建议起诉 (Drop)

- **触发条件**：
  - 不满足上述任一条件 (即：证据严重不足 且/或 偿债能力极差)。
- **核心逻辑**：ROI 极低或败诉风险极高，建议止损。
- **输出策略**：暂缓起诉，优先补充证据或止损。
- **适用场景**：诉讼得不偿失。

## 4. 关键模块实现

### 4.1 法律分析与法条引用 (已更新)

数据来源于“通义法睿”法规检索 API。

- **Schema升级**：
  - `title`: 法规名称 (如《中华人民共和国民法典》)
  - `statute`: 具体条款 (如“第五百七十七条”)
  - `effectivenessLevel`: 效力级别 (法律/行政法规/司法解释)
  - `publishDate`: 发布日期
  - `content`: 条款全文
- **分页支持**：支持前端分页浏览 (`currentPage`, `pageSize`)，避免长列表占用过多版面。
- **空状态处理**：无数据时显示“暂无相关法律依据”提示。

### 4.2 成本收益 (ROI) 计算

- **预估成本** = 律师费 + 诉讼费 (根据标的额分段计算) + 保全费
- **预期收益** = 诉讼本金 + 违约金/利息
- **ROI** = (预期收益 - 预估成本) / 预估成本

### 4.3 动态数据链

数据的变化会产生连锁反应：

1.  **证据状态改变** (如：用户标记“验收单”为丢失)
    ⬇️
2.  **证据覆盖率下降**
    ⬇️
3.  **决策分支改变** (可能从“建议起诉”变为“建议和解”)
    ⬇️
4.  **策略步骤更新** (自动增加“补充证据”步骤)

## 5. 交互与状态

- **初始状态**：显示占位符 + “刷新分析”按钮。
- **分析中**：按钮显示 Loading 状态，禁用操作。
- **分析完成**：展示完整报告，出现“导出报告”按钮。
- **导出功能**：前端动态生成 HTML 模板，包含所有分析图表和标签，利用 `Blob` 对象下载为 `.html` 文件，方便离线查看。
