# Legal Workspace v3 - æ¶æ„è®¾è®¡æ–‡æ¡£

> **ç‰ˆæœ¬**: v3.4 (Refactoring Completed)  
> **æœ€åæ›´æ–°**: 2026-01-06  
> **æ–‡æ¡£çŠ¶æ€**: å½“å‰æ¶æ„

## ğŸ“‹ ç›®å½•

- [1. æ¶æ„æ¦‚è§ˆ](#1-æ¶æ„æ¦‚è§ˆ)
- [2. æŠ€æœ¯æ ˆ](#2-æŠ€æœ¯æ ˆ)
- [3. é¡¹ç›®ç»“æ„](#3-é¡¹ç›®ç»“æ„)
- [5. æ•°æ®æµ](#5-æ•°æ®æµ)
- [6. æ¨¡å—è®¾è®¡](#6-æ¨¡å—è®¾è®¡)
- [7. çŠ¶æ€ç®¡ç†](#7-çŠ¶æ€ç®¡ç†)
- [8. è·¯ç”±ç³»ç»Ÿ](#8-è·¯ç”±ç³»ç»Ÿ)
- [9. è®¤è¯ç³»ç»Ÿ](#9-è®¤è¯ç³»ç»Ÿ)
- [10. ç»„ä»¶æ¶æ„](#10-ç»„ä»¶æ¶æ„)
- [11. æ•°æ®æ¨¡å‹ä¸å­—æ®µå®šä¹‰](#11-æ•°æ®æ¨¡å‹ä¸å­—æ®µå®šä¹‰)
- [12. API é›†æˆ](#12-api-é›†æˆ)
- [13. æ€§èƒ½ä¼˜åŒ–](#13-æ€§èƒ½ä¼˜åŒ–)
- [14. å®‰å…¨æ€§](#14-å®‰å…¨æ€§)
- [15. æœªæ¥è§„åˆ’](#15-æœªæ¥è§„åˆ’)

---

## 1. æ¶æ„æ¦‚è§ˆ

### 1.1 æ•´ä½“æ¶æ„

Legal Workspace v3 é‡‡ç”¨ **Feature-Based å‰ç«¯æ¶æ„**ï¼ŒåŸºäº **Vue 3 + Vite** æ„å»ºã€‚åç«¯é‡‡ç”¨ **Supabase (BaaS) + BFF (Node.js Gateway)** æ··åˆæ¨¡å¼ï¼Œæ”¯æŒå¹³æ»‘æ¼”è¿›åˆ°å¾®æœåŠ¡ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           ç”¨æˆ·å±•ç¤ºå±‚ (Presentation Layer)               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ä¸šåŠ¡æ¨¡å—:   â”‚  â”‚ ä¸šåŠ¡æ¨¡å—:   â”‚  â”‚ ä¸šåŠ¡æ¨¡å—:   â”‚  â”‚ å…¬å…±æ¨¡å—:         â”‚  â”‚
â”‚  â”‚ æ¡ˆä»¶ç®¡ç†    â”‚  â”‚ æ³•å¾‹æ£€ç´¢    â”‚  â”‚ æ–‡ä¹¦ç”Ÿæˆ    â”‚  â”‚ å¸ƒå±€/é€šç”¨ç»„ä»¶     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚        â”‚               â”‚               â”‚                   â”‚            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â–¼               â–¼               â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           é€»è¾‘ä¸æœåŠ¡å±‚ (Logic & Service)                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ç»„åˆå¼å‡½æ•°     â”‚  â”‚ çŠ¶æ€ç®¡ç† (Pinia)â”‚  â”‚ æœåŠ¡é€‚é…å™¨                â”‚  â”‚
â”‚  â”‚ (useCaseData)  â”‚  â”‚ (Auth/System)  â”‚  â”‚ (caseService)             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                         â”‚ (åŒæ¨¡å¼åˆ‡æ¢)
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â–¼                                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        BFF ç½‘å…³ (Node.js)            â”‚          â”‚        Supabase ç›´è¿ (SDK)           â”‚
â”‚  (è·¯ç”±: /api/v1/*)                   â”‚          â”‚  (è·¯ç”±: supabase.from())             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚          â”‚                                      â”‚
â”‚  â”‚ Token éªŒè¯  â”‚   â”‚ æµé‡æ§åˆ¶     â”‚  â”‚          â”‚                                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚          â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                 â”‚                                        â”‚
          â–¼                 â–¼                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           åŸºç¡€è®¾æ–½å±‚ (Infrastructure)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ PostgreSQL   â”‚   â”‚ å¯¹è±¡å­˜å‚¨     â”‚   â”‚ AI æœåŠ¡å•†   â”‚   â”‚ ç¬¬ä¸‰æ–¹     â”‚ â”‚
â”‚  â”‚ (Supabase)   â”‚   â”‚ (Docs/Imgs)  â”‚   â”‚ (é€šä¹‰æ³•ç¿)  â”‚   â”‚ APIs       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 è®¾è®¡åŸåˆ™

1. **æ¨¡å—åŒ–è®¾è®¡** - åŠŸèƒ½æ¨¡å—ç‹¬ç«‹ï¼Œæ˜“äºç»´æŠ¤å’Œæ‰©å±•
2. **ç»„ä»¶å¤ç”¨** - é€šç”¨ç»„ä»¶æŠ½å–ï¼Œå‡å°‘ä»£ç é‡å¤
3. **æ¸è¿›å¢å¼º** - åŸºç¡€åŠŸèƒ½ä¼˜å…ˆï¼Œé«˜çº§åŠŸèƒ½æ¨¡å—åŒ–
4. **ç”¨æˆ·ä½“éªŒ** - å“åº”å¼è®¾è®¡ï¼Œæµç•…äº¤äº’
5. **å®‰å…¨ç¬¬ä¸€** - è®¤è¯æˆæƒï¼Œæ•°æ®åŠ å¯†

---

## 2. æŠ€æœ¯æ ˆ

### 2.1 å‰ç«¯æŠ€æœ¯

| æŠ€æœ¯             | ç‰ˆæœ¬   | ç”¨é€”         | å¼•å…¥æ–¹å¼ |
| ---------------- | ------ | ------------ | -------- |
| **Vue 3**        | 3.4.21 | å‰ç«¯æ¡†æ¶     | npm      |
| **Vite**         | 5.4.21 | æ„å»ºå·¥å…·     | npm      |
| **D3.js**        | 7.8.5  | æ•°æ®å¯è§†åŒ–   | npm      |
| **Sass**         | æœ€æ–°   | CSS é¢„å¤„ç†å™¨ | npm      |
| **Font Awesome** | v6     | å›¾æ ‡åº“       | CDN      |

### 2.2 åç«¯æœåŠ¡

| æœåŠ¡             | ç”¨é€”             | è¯´æ˜              |
| ---------------- | ---------------- | ----------------- |
| **Supabase**     | ç”¨æˆ·è®¤è¯ã€æ•°æ®åº“ | PostgreSQL + Auth |
| **é€šä¹‰æ³•ç¿ API** | æ³•å¾‹æ£€ç´¢         | æ¡ˆä¾‹ã€æ³•è§„æ£€ç´¢    |
| **æœ¬åœ°å­˜å‚¨**     | ä¸´æ—¶æ•°æ®         | LocalStorage      |

### 2.3 å¼€å‘å·¥å…·

#### æ„å»ºä¸å¼€å‘

- **Vite 5.4.21** - å¼€å‘æœåŠ¡å™¨ å’Œç”Ÿäº§æ„å»º
- **npm** - åŒ…ç®¡ç†å’Œè„šæœ¬è¿è¡Œ

#### ä»£ç è´¨é‡

- **ESLint 8.56.0** - JavaScript/Vue ä»£ç è§„èŒƒæ£€æŸ¥
- **Prettier 3.2.4** - ä»£ç æ ¼å¼åŒ–
- **Husky 9.1.7** - Git Hooks ç®¡ç†
- **lint-staged** - æäº¤å‰è‡ªåŠ¨æ£€æŸ¥å’Œä¿®å¤

#### æµ‹è¯•æ¡†æ¶

- **Vitest** - å•å…ƒæµ‹è¯•æ¡†æ¶
- **@vue/test-utils** - Vue ç»„ä»¶æµ‹è¯•
- **happy-dom** - æµ‹è¯•ç¯å¢ƒ

#### CSS å¤„ç†

- **Sass (SCSS)** - CSS é¢„å¤„ç†å™¨
- **PostCSS + Autoprefixer** - è‡ªåŠ¨æµè§ˆå™¨å‰ç¼€

#### ç‰ˆæœ¬æ§åˆ¶ä¸éƒ¨ç½²

- **Git** - ç‰ˆæœ¬æ§åˆ¶
- **GitHub Pages** - åœ¨çº¿éƒ¨ç½²

### 2.4 å‰ç«¯è„šæ‰‹æ¶

é¡¹ç›®é‡‡ç”¨ **Vite + Vue 3** ç°ä»£åŒ–å·¥ç¨‹æ¶æ„ã€‚

#### 2.4.1 å¼€å‘å‘½ä»¤

```bash
# å¼€å‘ç¯å¢ƒï¼ˆçƒ­é‡è½½ï¼‰
npm run dev

# ç”Ÿäº§æ„å»º
npm run build

# é¢„è§ˆç”Ÿäº§æ„å»º
npm run preview

# ä»£ç æ£€æŸ¥å’Œä¿®å¤
npm run lint

# è¿è¡Œæµ‹è¯•
npm run test
npm run test:ui        # å¯è§†åŒ–æµ‹è¯•ç•Œé¢
npm run test:coverage  # ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
```

#### 2.4.2 ç›®å½•è§„èŒƒ

- **è§†å›¾å±‚ (`views/`)**: Vue SFC ç»„ä»¶å’Œ JS æ–‡ä»¶
- **ç»„ä»¶å±‚ (`components/`)**: é€šç”¨ UI ç»„ä»¶ï¼ˆSFCï¼‰
- **é…ç½®å±‚ (`config/`)**: ç¯å¢ƒé…ç½®ä¸å¸¸é‡
- **æ ·å¼å±‚ (`styles/`)**: SCSS æ¨¡å—åŒ–æ ·å¼
- **æµ‹è¯•å±‚ (`__tests__/`)**: å•å…ƒæµ‹è¯•æ–‡ä»¶

---

## 3. é¡¹ç›®ç»“æ„

### 3.1 ç›®å½•ç»“æ„

````
legal-workspace-vue/
â”œâ”€â”€ index.html                    # åº”ç”¨å…¥å£
â”œâ”€â”€ check-syntax.js               # è¯­æ³•æ£€æŸ¥å·¥å…·
â”‚
â”œâ”€â”€ src/                          # æºä»£ç 
â”‚   â”œâ”€â”€ main.js                   # åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ router/                   # è·¯ç”±é…ç½®
â”‚   â”œâ”€â”€ stores/                   # å…¨å±€çŠ¶æ€ (Pinia)
â”‚   â”œâ”€â”€ services/                 # å…¨å±€æœåŠ¡å±‚
â”‚   â”‚
â”‚   â”œâ”€â”€ features/                 #ç‰¹æ€§æ¨¡å— (Feature-Based)
â”‚   â”‚   â”œâ”€â”€ auth/                 # è®¤è¯æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ case/                 # æ¡ˆä»¶æ ¸å¿ƒæ¨¡å—
â”‚   â”‚   â”‚   â”œâ”€â”€ views/            # é¡µé¢è§†å›¾
â”‚   â”‚   â”‚   â”œâ”€â”€ components/       # æ¨¡å—ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ services/         # æ¨¡å—æœåŠ¡
â”‚   â”‚   â”‚   â””â”€â”€ composables/      # ç»„åˆå¼å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ contract/             # åˆåŒå®¡æŸ¥æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ document/             # æ–‡ä¹¦ç”Ÿæˆæ¨¡å—
â”‚   â”‚   â”œâ”€â”€ legal-research/       # æ³•å¾‹æ£€ç´¢æ¨¡å—
â”‚   â”‚   â””â”€â”€ system/               # ç³»ç»Ÿè®¾ç½®æ¨¡å—
â”‚   â”‚
â”‚   â”œâ”€â”€ components/               # é€šç”¨ç»„ä»¶
â”‚   â”œâ”€â”€ styles/                   # å…¨å±€æ ·å¼
â”‚   â””â”€â”€ shared/                   # å…±äº«å·¥å…·
â”‚
â”œâ”€â”€ tools/
â”‚   â””â”€â”€ mock-server/              # BFF Mock Server (Express)
â”‚
â””â”€â”€ docs/                         # æ–‡æ¡£
### 3.2 æ–‡ä»¶å‘½åè§„èŒƒ

- **ç»„ä»¶æ–‡ä»¶**: PascalCase (å¦‚ `CaseList.js`)
- **é…ç½®æ–‡ä»¶**: camelCase (å¦‚ `supabase.js`)
- **æ ·å¼æ–‡ä»¶**: kebab-case (å¦‚ `main.css`)
- **æ–‡æ¡£æ–‡ä»¶**: ä¸­æ–‡æˆ–è‹±æ–‡æè¿°æ€§åç§°

---

## æ ¸å¿ƒæ¶æ„

### 4.1 åº”ç”¨å…¥å£ (main.js)

```javascript
// æ ¸å¿ƒæµç¨‹
import { createApp } from 'vue'
import App from './App.vue'
import router from './router'
import './styles/main.scss'

const app = createApp(App)
app.use(router)
app.mount('#app')
````

**å…³é”®ç‰¹æ€§**:

- **createApp API**: Vue 3 æ ‡å‡†å®ä¾‹åˆ›å»º
- **å…¨å±€é…ç½®**: æ’ä»¶ (Router, Pinia/Store) ç»Ÿä¸€æ³¨å†Œ
- **æ ·å¼å…¥å£**: é›†ä¸­å¼•å…¥ SCSS
- **é”™è¯¯è¾¹ç•Œ**: å…¨å±€ `errorHandler` é…ç½®

### 4.2 è·¯ç”±ç³»ç»Ÿ (vue-router)

é‡‡ç”¨ **Vue Router 4** è¿›è¡Œæ¨¡å—åŒ–è·¯ç”±ç®¡ç†ã€‚

```javascript
// src/router/index.js
const router = createRouter({
  history: createWebHashHistory(),
  routes: [
    ...caseRoutes,
    ...authRoutes,
    ...legalResearchRoutes
    // ...
  ]
})
```

**ç‰¹ç‚¹**:

- **æ¨¡å—åŒ–**: è·¯ç”±é…ç½®åˆ†æ•£åœ¨ `modules/` ç›®å½•
- **å®ˆå«åˆ†ç¦»**: è®¤è¯é€»è¾‘æŠ½ç¦»è‡³ `guards.js`
- **æ‡’åŠ è½½**: ç»„ä»¶ä½¿ç”¨ `import()` åŠ¨æ€åŠ è½½

### 4.3 BFF Mock Server (ä»£ç†æ¨¡å¼)

ä½äº `tools/mock-server/`ï¼ŒåŸºäº Express å®ç°çš„è½»é‡çº§ BFF å±‚ï¼Œç”¨äºæœ¬åœ°å¼€å‘å’Œé€»è¾‘è§£è€¦ã€‚

**æ ¸å¿ƒåŠŸèƒ½**:

1.  **Supabase ä»£ç†**: é€šè¿‡ `supabase-js` æœåŠ¡ç«¯ SDK è½¬å‘è¯·æ±‚ï¼Œå¤ç”¨ RLS ç­–ç•¥ã€‚
2.  **API èšåˆ**: å°†å‰ç«¯å¤æ‚çš„æŸäº›è¯·æ±‚ï¼ˆå¦‚æ¡ˆä»¶+å½“äº‹äºº+æ—¶é—´è½´ï¼‰åœ¨æœåŠ¡ç«¯èšåˆã€‚
3.  **Mock æ•°æ®**: ä¸ºå°šæœªå¼€å‘çš„ API æä¾›æ¨¡æ‹Ÿå“åº”ã€‚

**å¯åŠ¨æ–¹å¼**:
`npm run mock:server` (ç«¯å£ 3000)

**ç¯å¢ƒé…ç½® (`.env`)**:

```bash
VITE_USE_BFF=true           # å¼€å¯ BFF ä»£ç†æ¨¡å¼
VITE_API_BASE_URL=http://localhost:3000/api/v1
```

---

## 5. æ•°æ®æµ

### 5.1 æ•°æ®æµå‘å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·æ“ä½œ  â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Vue ç»„ä»¶  â”‚ â† å“åº”å¼æ•°æ®ç»‘å®š
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ çŠ¶æ€ç®¡ç†  â”‚ (authStore, ç»„ä»¶å†…éƒ¨çŠ¶æ€)
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æœåŠ¡å±‚    â”‚ (authService, filterService, brandService)
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ•°æ®æº    â”‚ (Supabase, API, LocalStorage)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 è®¤è¯æ•°æ®æµ

```
ç”¨æˆ·ç™»å½•
  â†“
authService.signIn(email, password)
  â†“
Supabase Auth API
  â†“
è¿”å› session
  â†“
authStore.setAuth(session)
  â†“
è§¦å‘ onAuthStateChange
  â†“
åŠ è½½ç”¨æˆ·èµ„æ–™ (loadUserProfile)
  â†“
æ›´æ–° UI (å¤´åƒã€ç”¨æˆ·åç­‰)
```

---

## 6. æ¨¡å—è®¾è®¡

### 6.1 æ¡ˆä»¶ç®¡ç†æ¨¡å— (features/case)

- **å…¥å£**: `views/CaseModuleLayout.vue`
- **æ ¸å¿ƒè§†å›¾**:
  - `views/CaseList.vue`: æ¡ˆä»¶åˆ—è¡¨æ£€ç´¢ä¸ç­›é€‰
  - `views/CaseDetail.vue`: è¯¦æƒ…é¡µå®¹å™¨ (æä¾› `caseId`)
  - `views/CaseForm.vue`: æ–°å»º/ç¼–è¾‘è¡¨å•
- **å­åŠŸèƒ½æ¨¡å— (`modules/`)**: (å…¨éƒ¨ SFC)
  - `CaseBasicInfo.vue`: åŸºç¡€ä¿¡æ¯ç®¡ç†
  - `CaseStakeholders.vue`: å½“äº‹äººç®¡ç†
  - `CaseEvidence.vue`: è¯æ®åˆ—è¡¨ä¸ä¸Šä¼ 
  - `CaseFinancials.vue`: è´¹ç”¨ä¸åˆ©æ¯è®¡ç®—
  - `CaseAdvanced.vue`: é«˜çº§åˆ†æå…¥å£
- **çŠ¶æ€ç®¡ç†ä¸é€»è¾‘å¤ç”¨**:
  - **Composables**:
    - `useCaseData.js`: æ¡ˆä»¶æ ¸å¿ƒæ•°æ®ç®¡ç†
    - `useCaseList.js`: åˆ—è¡¨æ£€ç´¢é€»è¾‘
    - `useCaseDetail.js`: è¯¦æƒ…é¡µåŠ è½½é€»è¾‘
    - `useStakeholders.js`: å½“äº‹äººå¢åˆ æ”¹æŸ¥
    - `useModal.js`: ç»Ÿä¸€æ¨¡æ€æ¡†æ§åˆ¶
  - **Local Services**:
    - `caseService.js`: æ¡ˆä»¶ CRUD
    - `financialService.js`: è´¢åŠ¡è®¡ç®—æœåŠ¡
    - `evidenceService.js`: è¯æ®å¤„ç†æœåŠ¡
    - `aiService.js`: æ¨¡å—ä¸“å± AI æœåŠ¡
    - `caseCache.js`: è¯¦æƒ…é¡µ SessionStorage ç¼“å­˜

### 6.2 æ³•å¾‹æ£€ç´¢æ¨¡å— (features/legal-research)

- **æ ¸å¿ƒç»„ä»¶**: `LegalResearch.vue`
- **åŠŸèƒ½**:
  - ç»Ÿä¸€æ£€ç´¢å…¥å£ (æ”¯æŒå…³é”®è¯ä¸è‡ªç„¶è¯­è¨€)
  - ç»“æœå±•ç¤º: `CaseSearchResults.vue`, `RegulationSearchResults.vue`
  - è¯¦æƒ…ä¾§æ»‘: `components/CaseDetailParams.vue`
  - å†å²è®°å½•: `components/HistoryModal.vue`

### 6.3 è¾…åŠ©æ¨¡å—

- **auth (è®¤è¯)**: ç™»å½•/æ³¨å†Œ/é‡ç½®å¯†ç  (`features/auth`)
- **document (æ–‡ä¹¦)**: æ³•å¾‹æ–‡ä¹¦ç”Ÿæˆ (`features/document`)
- **contract (åˆåŒ)**: æ™ºèƒ½åˆåŒå®¡æŸ¥ (`features/contract`)
- **system (è®¾ç½®)**: ä¸ªäººèµ„æ–™ä¸ç³»ç»Ÿé…ç½® (`features/system`)

## 7. çŠ¶æ€ç®¡ç†

### 7.1 è®¤è¯çŠ¶æ€ (authStore.js)

```javascript
const authStore = Vue.reactive({
    user: null,           // å½“å‰ç”¨æˆ·
    session: null,        // ä¼šè¯ä¿¡æ¯
    loading: true,        // åŠ è½½çŠ¶æ€
    avatarUrl: null,      // ç”¨æˆ·å¤´åƒ
    title: null,          // ç”¨æˆ·èŒä½

    // æ–¹æ³•
    setAuth(session),
    clearAuth(),
    setAvatarUrl(url),
    setTitle(title),
    isAuthenticated()
});
```

**ç‰¹ç‚¹**:

- Vue 3 å“åº”å¼å¯¹è±¡
- å…¨å±€å…±äº«
- è‡ªåŠ¨æŒä¹…åŒ– (é€šè¿‡ Supabase)

### 7.2 ç»„ä»¶å†…éƒ¨çŠ¶æ€

æ¯ä¸ªç»„ä»¶ç»´æŠ¤è‡ªå·±çš„å±€éƒ¨çŠ¶æ€:

```javascript
data() {
    return {
        cases: [],        // æ¡ˆä»¶åˆ—è¡¨
        loading: false,   // åŠ è½½çŠ¶æ€
        filters: {},      // ç­›é€‰æ¡ä»¶
        // ...
    }
}
```

---

## 8. è·¯ç”±ç³»ç»Ÿ

### 8.1 è·¯ç”±è¡¨

| è·¯ç”±è·¯å¾„                     | ç»„ä»¶                    | è¯´æ˜     | è®¤è¯è¦æ±‚ |
| ---------------------------- | ----------------------- | -------- | -------- |
| `/`                          | CaseList                | æ¡ˆä»¶åˆ—è¡¨ | âœ…       |
| `/detail`                    | CaseDetail              | æ¡ˆä»¶è¯¦æƒ… | âœ…       |
| `/create`                    | CaseForm                | æ–°å»ºæ¡ˆä»¶ | âœ…       |
| `/edit`                      | CaseForm                | ç¼–è¾‘æ¡ˆä»¶ | âœ…       |
| `/evidence-upload`           | EvidenceUpload          | è¯æ®ä¸Šä¼  | âœ…       |
| `/legal-research`            | LegalResearch           | æ³•å¾‹æ£€ç´¢ | âœ…       |
| `/case-search-results`       | CaseSearchResults       | æ¡ˆä¾‹ç»“æœ | âœ…       |
| `/regulation-search-results` | RegulationSearchResults | æ³•è§„ç»“æœ | âœ…       |
| `/contract-review`           | ContractReview          | åˆåŒå®¡æŸ¥ | âœ…       |
| `/doc-generate`              | DocGenerate             | æ–‡ä¹¦ç”Ÿæˆ | âœ…       |
| `/profile`                   | UserProfile             | ä¸ªäººèµ„æ–™ | âœ…       |
| `/settings`                  | Settings                | ç³»ç»Ÿè®¾ç½® | âœ…       |
| `/feedback`                  | ProductFeedback         | äº§å“åé¦ˆ | âœ…       |
| `/login`                     | Login                   | ç™»å½•     | âŒ       |
| `/register`                  | Register                | æ³¨å†Œ     | âŒ       |
| `/forgot-password`           | ForgotPassword          | å¿˜è®°å¯†ç  | âŒ       |

### 8.2 è·¯ç”±å®ˆå«

```javascript
// åœ¨ main.js ä¸­å®ç°
computed: {
    requiresAuth() {
        const publicRoutes = ['/login', '/register', '/forgot-password'];
        return !publicRoutes.includes(this.currentRoute);
    }
},
methods: {
    onRouteChange() {
        if (this.requiresAuth && !authStore.isAuthenticated()) {
            router.push('/login');
        }
    }
}
```

---

## 9. è®¤è¯ç³»ç»Ÿ

### 9.1 è®¤è¯æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·è®¿é—®    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ£€æŸ¥ä¼šè¯     â”‚ â† Supabase getSession()
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â†“
  â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
  â”‚ å·²ç™»å½•ï¼Ÿ â”‚
  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
   Yes â”‚ No
       â”‚    â””â”€â”€â†’ é‡å®šå‘åˆ° /login
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åŠ è½½ç”¨æˆ·èµ„æ–™ â”‚ â† profiles è¡¨
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ˜¾ç¤ºåº”ç”¨ç•Œé¢ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9.2 è®¤è¯æœåŠ¡ (authService)

```javascript
export const authService = {
    signUp(email, password, metadata),    // æ³¨å†Œ
    signIn(email, password),              // ç™»å½•
    signOut(),                            // ç™»å‡º
    getCurrentUser(),                     // è·å–å½“å‰ç”¨æˆ·
    getSession(),                         // è·å–ä¼šè¯
    onAuthStateChange(callback),          // ç›‘å¬çŠ¶æ€å˜åŒ–
    resetPassword(email),                 // é‡ç½®å¯†ç 
    updateUser(updates)                   // æ›´æ–°ç”¨æˆ·ä¿¡æ¯
};
```

### 9.3 ä¼šè¯ç®¡ç†

- **ä¼šè¯å­˜å‚¨**: Supabase è‡ªåŠ¨ç®¡ç† (localStorage)
- **ä¼šè¯åˆ·æ–°**: è‡ªåŠ¨åˆ·æ–° token
- **ä¼šè¯è¿‡æœŸ**: è‡ªåŠ¨é‡å®šå‘åˆ°ç™»å½•é¡µ

---

## 10. ç»„ä»¶æ¶æ„

### 10.1 ç»„ä»¶åˆ†ç±»

#### å¸ƒå±€ç»„ä»¶ (Layout Components)

- `layouts/AppLayout.vue` - ä¸»å¸ƒå±€å®¹å™¨
- `components/layout/Sidebar.vue` - ä¾§è¾¹æ å¯¼èˆª

#### è§†å›¾ç»„ä»¶ (Feature Views)

- `features/case/views/CaseDetail.vue`
- `features/auth/views/Login.vue`

#### ä¸šåŠ¡ç»„ä»¶ (Feature Modules)

- `features/case/modules/CaseBasicInfo.vue`
- `features/case/modules/CaseStakeholders.vue`

#### é€šç”¨ç»„ä»¶ (Shared Components)

- `components/common/ConfirmModal.vue` - ç¡®è®¤/æç¤ºå¼¹çª—

### 10.2 ç»„ä»¶é€šä¿¡

æ¨èä½¿ç”¨ **Props/Emit** å’Œ **Provide/Inject**ã€‚

```vue
<!-- çˆ¶ç»„ä»¶ -->
<script setup>
import { provide, ref } from 'vue'
const caseData = ref({})
provide('caseData', caseData)
</script>

<!-- å­ç»„ä»¶ -->
<script setup>
import { inject } from 'vue'
const caseData = inject('caseData')
</script>
```

### 10.3 ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ (Composition API)

ä½¿ç”¨ Hooks ä»£æ›¿ Options API é’©å­ã€‚

```javascript
import { onMounted, onUnmounted } from 'vue'

export default {
  setup() {
    onMounted(() => {
      console.log('Component Mounted')
    })

    onUnmounted(() => {
      // æ¸…ç†å‰¯ä½œç”¨
    })
  }
}
```

---

## 11. æ•°æ®æ¨¡å‹ä¸å­—æ®µå®šä¹‰

> æœ¬èŠ‚å®šä¹‰ç³»ç»Ÿä¸­æ‰€æœ‰æ•°æ®è¡¨çš„å­—æ®µç»“æ„ã€ç±»å‹åŠå…¶åº”ç”¨åœºæ™¯ã€‚

### 11.1 æ¡ˆä»¶åŸºç¡€ä¿¡æ¯è¡¨ (cases)

| å­—æ®µåç§°             | æ•°æ®ç±»å‹  | å­—æ®µæè¿°                        | AI åº”ç”¨åœºæ™¯                |
| :------------------- | :-------- | :------------------------------ | :------------------------- |
| `id`                 | UUID      | æ¡ˆä»¶å”¯ä¸€æ ‡è¯†ç¬¦                  | ç³»ç»Ÿç´¢å¼•                   |
| `user_id`            | UUID      | ç”¨æˆ·IDï¼ˆå¤–é”®ï¼‰                  | ç”¨æˆ·éš”ç¦»                   |
| `case_title`         | String    | æ¡ˆä»¶æ ‡é¢˜                        | æ ‡é¢˜ç”Ÿæˆ                   |
| `case_number`        | String    | æ¡ˆä»¶ç¼–å·                        | æ¡ˆä»¶æ£€ç´¢                   |
| `case_type`          | String    | æ¡ˆç”±ç±»å‹                        | å†³å®šAIè°ƒç”¨å“ªä¸ªé¢†åŸŸçš„æ³•å¾‹åº“ |
| `legal_cause`        | String    | å…·ä½“æ¡ˆç”±                        | ç²¾å‡†åˆ¤ä¾‹åŒ¹é…               |
| `case_stage`         | String    | æ¡ˆä»¶é˜¶æ®µ                        | æµç¨‹è‡ªåŠ¨åŒ–æé†’             |
| `jurisdiction_court` | String    | ç®¡è¾–æ³•é™¢/ä»²è£å§”                 | åˆ†æè¯¥æ³•é™¢è¿‡å¾€åˆ¤å†³å€¾å‘     |
| `judge_name`         | String    | æ‰¿åŠæ³•å®˜                        | åˆ†ææ³•å®˜ç”»åƒ               |
| `filing_date`        | Date      | ç«‹æ¡ˆæ—¥æœŸ                        | è®¡ç®—å®¡é™                   |
| `statute_deadline`   | Date      | è¯‰è®¼æ—¶æ•ˆ/ä¸Šè¯‰æˆªæ­¢æ—¥             | é«˜å±é£é™©é¢„è­¦               |
| `status`             | String    | æ¡ˆä»¶çŠ¶æ€ï¼ˆdraft/active/closedï¼‰ | çŠ¶æ€æµè½¬                   |
| `created_at`         | Timestamp | åˆ›å»ºæ—¶é—´                        | æ’åº                       |
| `updated_at`         | Timestamp | æ›´æ–°æ—¶é—´                        | æ’åº                       |

---

### 11.2 æ ¸å¿ƒäº‹å®ä¸æ¡ˆæƒ…æè¿°

| å­—æ®µåç§°           | æ•°æ®ç±»å‹ | å­—æ®µæè¿° | AI åº”ç”¨åœºæ™¯             |
| :----------------- | :------- | :------- | :---------------------- |
| `fact_summary`     | Text     | æ¡ˆæƒ…æ‘˜è¦ | ç”Ÿæˆèµ·è¯‰çŠ¶/ç­”è¾©çŠ¶çš„åŸºç¡€ |
| `dispute_focus`    | Text     | äº‰è®®ç„¦ç‚¹ | é’ˆå¯¹æ€§æ³•å¾‹æ£€ç´¢          |
| `client_objective` | Text     | å®¢æˆ·è¯‰æ±‚ | ç­–ç•¥åˆ¶å®šçš„ç›®æ ‡å¯¼å‘      |

---

### 11.3 å½“äº‹äººä¸å…³ç³»æ–¹ (parties - JSONBå­—æ®µ)

| å­—æ®µåç§°           | æ•°æ®ç±»å‹ | å­—æ®µæè¿°                 | AI åº”ç”¨åœºæ™¯      |
| :----------------- | :------- | :----------------------- | :--------------- |
| `party_type`       | String   | è§’è‰²ï¼ˆåŸå‘Š/è¢«å‘Š/ç¬¬ä¸‰äººï¼‰ | ç¡®å®šæ–‡ä¹¦ä¸­çš„ç§°è°“ |
| `entity_type`      | String   | ä¸»ä½“ç±»å‹ï¼ˆè‡ªç„¶äºº/æ³•äººï¼‰  | æ ¡éªŒä¸»ä½“èµ„æ ¼å­—æ®µ |
| `name`             | String   | å§“å/åç§°                | æ–‡ä¹¦è‡ªåŠ¨å¡«å……     |
| `legal_rep`        | String   | æ³•å®šä»£è¡¨äºº               | æ–‡ä¹¦è‡ªåŠ¨å¡«å……     |
| `opposing_counsel` | String   | å¯¹æ–¹ä»£ç†å¾‹å¸ˆ             | åˆ†æå¯¹æ‰‹é£æ ¼     |

---

### 11.4 è¯æ®ç®¡ç†ä¸åˆ†æ (evidence - è§„åˆ’ä¸­)

| å­—æ®µåç§°             | æ•°æ®ç±»å‹ | å­—æ®µæè¿°             | AI åº”ç”¨åœºæ™¯        |
| :------------------- | :------- | :------------------- | :----------------- |
| `evidence_name`      | String   | è¯æ®åç§°             | è¯æ®ç›®å½•ç”Ÿæˆ       |
| `evidence_type`      | String   | è¯æ®ç§ç±»             | é€‚ç”¨ä¸åŒçš„è´¨è¯è§„åˆ™ |
| `file_path`          | String   | æ–‡ä»¶å­˜å‚¨è·¯å¾„         | OCRè¯†åˆ«å†…å®¹        |
| `ocr_content`        | Text     | è¯æ®å†…å®¹çš„æ–‡æœ¬æå–   | å…³é”®è¯æœç´¢         |
| `proof_purpose`      | Text     | è¯æ˜ç›®çš„             | è‡ªåŠ¨ç”Ÿæˆè´¨è¯æ„è§   |
| `authenticity_score` | Float    | çœŸå®æ€§è¯„åˆ†ï¼ˆAIé¢„åˆ¤ï¼‰ | é£é™©æç¤º           |
| `relevance_score`    | Float    | å…³è”æ€§è¯„åˆ†ï¼ˆAIé¢„åˆ¤ï¼‰ | å‰”é™¤æ— æ•ˆè¯æ®       |

---

### 11.5 æ³•å¾‹ç ”ç©¶ä¸AIæ¨ç†

| å­—æ®µåç§°              | æ•°æ®ç±»å‹   | å­—æ®µæè¿°         | AI åº”ç”¨åœºæ™¯      |
| :-------------------- | :--------- | :--------------- | :--------------- |
| `matched_laws`        | JSON       | åŒ¹é…çš„æ³•æ¡       | æ³•å¾‹ä¾æ®å¼•ç”¨     |
| `similar_cases`       | Array      | ç›¸ä¼¼ç±»æ¡ˆID       | ç±»æ¡ˆåŒåˆ¤å‚è€ƒ     |
| `win_probability`     | Percentage | èƒœè¯‰ç‡é¢„æµ‹       | å®¢æˆ·é¢„æœŸç®¡ç†     |
| `risk_points`         | Array      | é£é™©ç‚¹æç¤º       | æ¡ˆä»¶è¯Šæ–­æŠ¥å‘Š     |
| `strategy_suggestion` | Text       | AIå»ºè®®çš„è¯‰è®¼ç­–ç•¥ | å¾‹å¸ˆåŠæ¡ˆæ€è·¯è¾…åŠ© |

---

### 11.6 è´¢åŠ¡ä¸æ ‡çš„ (financial - JSONBå­—æ®µ)

| å­—æ®µåç§°         | æ•°æ®ç±»å‹ | å­—æ®µæè¿°   |
| :--------------- | :------- | :--------- |
| `claim_amount`   | Decimal  | è¯‰è®¼æ ‡çš„é¢ |
| `attorney_fee`   | Decimal  | å¾‹å¸ˆè´¹æŠ¥ä»· |
| `court_cost`     | Decimal  | é¢„ä¼°è¯‰è®¼è´¹ |
| `billable_hours` | Float    | è®¡è´¹æ—¶é•¿   |

---

### 11.7 è”ç»œäººä¿¡æ¯ (contact - JSONBå­—æ®µ)

| å­—æ®µåç§°          | æ•°æ®ç±»å‹ | å­—æ®µæè¿°   |
| :---------------- | :------- | :--------- |
| `contact_name`    | String   | è”ç»œäººå§“å |
| `contact_role`    | String   | èŒä½/è§’è‰²  |
| `contact_phone`   | String   | è”ç³»ç”µè¯   |
| `contact_email`   | String   | ç”µå­é‚®ç®±   |
| `contact_address` | String   | è”ç³»åœ°å€   |

---

### 11.8 ç”¨æˆ·èµ„æ–™è¡¨ (profiles)

| å­—æ®µåç§°          | æ•°æ®ç±»å‹  | å­—æ®µæè¿°               |
| :---------------- | :-------- | :--------------------- |
| `id`              | UUID      | ä¸»é”®ï¼ˆå…³è”auth.usersï¼‰ |
| `email`           | String    | é‚®ç®±                   |
| `full_name`       | String    | å§“å                   |
| `avatar_url`      | String    | å¤´åƒURL                |
| `title`           | String    | èŒä½                   |
| `phone`           | String    | ç”µè¯                   |
| `department`      | String    | æ‰€å±éƒ¨é—¨               |
| `office_location` | String    | åŠå…¬åœ°ç‚¹               |
| `bio`             | Text      | ä¸ªäººç®€ä»‹               |
| `created_at`      | Timestamp | åˆ›å»ºæ—¶é—´               |
| `updated_at`      | Timestamp | æ›´æ–°æ—¶é—´               |

---

### 11.9 ç­›é€‰é¡¹é…ç½®è¡¨ (search_filter_options)

| å­—æ®µ            | ç±»å‹    | è¯´æ˜                   |
| --------------- | ------- | ---------------------- |
| `id`            | UUID    | ä¸»é”®                   |
| `category`      | String  | åˆ†ç±» (case/regulation) |
| `filter_key`    | String  | ç­›é€‰é”®                 |
| `label`         | String  | æ˜¾ç¤ºæ ‡ç­¾               |
| `value`         | String  | å€¼                     |
| `display_order` | Integer | æ˜¾ç¤ºé¡ºåº               |
| `is_active`     | Boolean | æ˜¯å¦å¯ç”¨               |

---

### 11.10 å“ç‰Œè®¾ç½®è¡¨ (brand_settings)

| å­—æ®µ            | ç±»å‹   | è¯´æ˜   |
| --------------- | ------ | ------ |
| `id`            | UUID   | ä¸»é”®   |
| `setting_key`   | String | è®¾ç½®é”® |
| `setting_value` | String | è®¾ç½®å€¼ |
| `setting_type`  | String | ç±»å‹   |

---

### 11.11 äº§å“åé¦ˆè¡¨ (product_feedback)

| å­—æ®µåç§°      | æ•°æ®ç±»å‹  | å­—æ®µæè¿° |
| :------------ | :-------- | :------- |
| `id`          | UUID      | ä¸»é”®     |
| `user_id`     | UUID      | ç”¨æˆ·ID   |
| `category`    | String    | åˆ†ç±»     |
| `title`       | String    | æ ‡é¢˜     |
| `description` | Text      | æè¿°     |
| `priority`    | String    | ä¼˜å…ˆçº§   |
| `status`      | String    | çŠ¶æ€     |
| `created_at`  | Timestamp | åˆ›å»ºæ—¶é—´ |

---

### 11.12 æ•°æ®åº“å…³ç³»

```
auth.users (Supabase Auth)
    â†“ 1:1
profiles
    â†“ 1:N
cases
    â†“ 1:N
evidence (è®¡åˆ’ä¸­)

search_filter_options (ç‹¬ç«‹è¡¨)
brand_settings (ç‹¬ç«‹è¡¨)
product_feedback â†’ user_id â†’ auth.users
```

---

## 12. API é›†æˆ

### 12.1 é€šä¹‰æ³•ç¿ API

#### æ¡ˆä¾‹æ£€ç´¢ API

**ç«¯ç‚¹**: `POST /api/case-search`

**è¯·æ±‚å‚æ•°**:

```javascript
{
  query: "åˆåŒçº çº·",
  filters: {
    court: "æœ€é«˜äººæ°‘æ³•é™¢",
    caseType: "æ°‘äº‹æ¡ˆä»¶",
    year: "2023"
  },
  page: 1,
  pageSize: 20
}
```

**å“åº”**:

```javascript
{
  total: 100,
  cases: [
    {
      id: "xxx",
      title: "æ¡ˆä»¶æ ‡é¢˜",
      court: "æ³•é™¢",
      date: "2023-01-01",
      summary: "æ‘˜è¦",
      // ...
    }
  ]
}
```

#### æ³•è§„æ£€ç´¢ API

**ç«¯ç‚¹**: `POST /api/regulation-search`

**è¯·æ±‚å‚æ•°**:

```javascript
{
  query: "åˆåŒæ³•",
  filters: {
    category: "æ³•å¾‹",
    effectStatus: "æœ‰æ•ˆ"
  },
  page: 1,
  pageSize: 20
}
```

### 12.2 Supabase API

é€šè¿‡ `supabase.js` å°è£…çš„æœåŠ¡:

- `authService` - è®¤è¯æœåŠ¡
- `filterService` - ç­›é€‰é¡¹æœåŠ¡
- `brandService` - å“ç‰Œè®¾ç½®æœåŠ¡

**ç¤ºä¾‹**:

```javascript
// è·å–æ¡ˆä»¶åˆ—è¡¨
const { data, error } = await supabase
    .from('cases')
    .select('*')
    .eq('user_id', userId)
  }
}
```

### 12.3 æœåŠ¡å±‚å°è£… (Service Layer)

æœåŠ¡å±‚é‡‡ç”¨ **Global/Feature** åˆ†å±‚ç­–ç•¥ï¼š

1.  **å…¨å±€æ ¸å¿ƒæœåŠ¡ (`src/services/`)**:
    - `api-client.js`: ç»Ÿä¸€ Axios å®ä¾‹ (Token/Exception Handler)
    - `authService.js`: ç”¨æˆ·è®¤è¯ä¸ä¼šè¯ç®¡ç†
    - `faruiService.js`: é€šä¹‰æ³•ç¿æ³•å¾‹æ£€ç´¢ (BFF Adapter)
    - `llmService.js`: å¤§æ¨¡å‹é€šç”¨æ¥å£
    - `lprService.js`: åˆ©ç‡æ•°æ® SDK
    - `lawCache.js`: å…¨å±€æ³•è§„ç¼“å­˜

2.  **ä¸šåŠ¡æ¨¡å—æœåŠ¡ (`src/features/*/services/`)**:
    - `caseService.js`: æ¡ˆä»¶æ•°æ® CRUD
    - `financialService.js`: å¤æ‚çš„åˆ©æ¯/è´¹ç”¨è®¡ç®—é€»è¾‘
    - `stakeholderService.js`: å½“äº‹äººæ•°æ®å¤„ç†
    - `evidenceService.js`: è¯æ®ä¸Šä¼ ä¸åˆ†æ
    - `aiService.js`: æ¡ˆä»¶ä¸“å± AI åˆ†æ

3.  **ç¼“å­˜ç­–ç•¥**:
    - **SessionStorage**: æ¡ˆä»¶è¯¦æƒ… (10åˆ†é’Ÿ)
    - **LocalStorage**: ç”¨æˆ·ä¸ªæ€§åŒ–é…ç½®ã€å†å²è®°å½•

---

## 13. æ€§èƒ½ä¼˜åŒ–

### 13.1 å·²å®ç°çš„ä¼˜åŒ–

1. **Vite æ„å»ºä¼˜åŒ–**
   - æé€Ÿå†·å¯åŠ¨
   - é—ªç”µèˆ¬çš„ HMR (çƒ­æ¨¡å—æ›¿æ¢)
   - ç”Ÿäº§ç¯å¢ƒ Tree-shaking
   - ä»£ç åˆ†å‰²å’Œæ‡’åŠ è½½

2. **èµ„æºä¼˜åŒ–**
   - npm åŒ…ç®¡ç†ï¼Œç‰ˆæœ¬é”å®š
   - èµ„æºå“ˆå¸Œç¼“å­˜
   - Autoprefixer è‡ªåŠ¨æµè§ˆå™¨å…¼å®¹

3. **åº”ç”¨ä¼˜åŒ–**
   - æŒ‰éœ€åŠ è½½ - ç»„ä»¶åŠ¨æ€å¯¼å…¥
   - ç¼“å­˜æœºåˆ¶ - å“ç‰Œè®¾ç½® 5 åˆ†é’Ÿç¼“å­˜
   - å“åº”å¼æ•°æ® - Vue 3 å“åº”å¼ç³»ç»Ÿ

### 13.2 è®¡åˆ’ä¸­çš„ä¼˜åŒ–

1. **å›¾ç‰‡æ‡’åŠ è½½** - è¯æ®å›¾ç‰‡æ‡’åŠ è½½
2. **è™šæ‹Ÿæ»šåŠ¨** - é•¿åˆ—è¡¨è™šæ‹Ÿæ»šåŠ¨
3. **Service Worker** - ç¦»çº¿ç¼“å­˜

---

## 14. å®‰å…¨æ€§

### 14.1 è®¤è¯å®‰å…¨

- **Supabase Auth** - è¡Œä¸šæ ‡å‡†çš„è®¤è¯ç³»ç»Ÿ
- **JWT Token** - å®‰å…¨çš„ä¼šè¯ç®¡ç†
- **å¯†ç åŠ å¯†** - bcrypt åŠ å¯†å­˜å‚¨
- **ä¼šè¯è¿‡æœŸ** - è‡ªåŠ¨è¿‡æœŸå’Œåˆ·æ–°

### 14.2 æ•°æ®å®‰å…¨

- **Row Level Security (RLS)** - Supabase è¡Œçº§å®‰å…¨ç­–ç•¥
- **ç”¨æˆ·éš”ç¦»** - æ¯ä¸ªç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„æ•°æ®
- **è¾“å…¥éªŒè¯** - å‰ç«¯è¡¨å•éªŒè¯
- **XSS é˜²æŠ¤** - Vue è‡ªåŠ¨è½¬ä¹‰

### 14.3 API å®‰å…¨

- **CORS é…ç½®** - è·¨åŸŸè¯·æ±‚é™åˆ¶
- **Rate Limiting** - API è¯·æ±‚é¢‘ç‡é™åˆ¶ (è®¡åˆ’ä¸­)
- **API Key ç®¡ç†** - ç¯å¢ƒå˜é‡å­˜å‚¨

---

## 15. å¾®æœåŠ¡æ²»ç†å‡†å¤‡ (Microservices Readiness)

> æœ¬èŠ‚é˜è¿°å¦‚æœç³»ç»Ÿéœ€è¦æ¼”è¿›ä¸ºå¾®æœåŠ¡æ¶æ„ï¼Œæ‰€éœ€çš„å…³é”®æ”¹åŠ¨å’Œå‡†å¤‡å·¥ä½œã€‚ç›®å‰æ¶æ„ä¸º Monolithic-over-BaaSï¼Œæ”¹åŠ¨é‡çº§è¯„çº§ï¼š**é‡å¤§ (High Effort)**ã€‚

### 15.1 æ¶æ„æ¼”è¿›è·¯çº¿

ç›®å‰çš„æ¶æ„æ˜¯å¼ºä¾èµ– Supabase çš„å¯Œå‰ç«¯æ¨¡å¼ã€‚è¦è½¬å‘å¾®æœåŠ¡æ²»ç†ï¼Œéœ€è¦ç»å†ä¸‰ä¸ªé˜¶æ®µçš„é‡æ„ï¼š

**Stage 1: å¼•å…¥ BFF å±‚ (ç½‘å…³æ¨¡å¼)**

- **ç°çŠ¶**: å‰ç«¯ç›´æ¥è°ƒç”¨ `supabase-js` è®¿é—®æ•°æ®åº“ã€‚
- **æ”¹åŠ¨**: å¼•å…¥ Node.js/Go æœåŠ¡ä½œä¸º API ç½‘å…³ï¼ˆBFFï¼‰ã€‚å‰ç«¯æ”¹ä¸ºè°ƒç”¨ BFFï¼ŒBFF å†è°ƒç”¨ Supabaseã€‚
- **ç›®çš„**: è§£è€¦å‰ç«¯ä¸æ•°æ®åº“ï¼Œä¸ºåç«¯é€»è¾‘ä¸‹æ²‰åšå‡†å¤‡ã€‚

**Stage 2: é€»è¾‘ä¸‹æ²‰ (å» BaaS åŒ–)**

- **ç°çŠ¶**: ä¸šåŠ¡é€»è¾‘åˆ†æ•£åœ¨å‰ç«¯ç»„ä»¶å’Œæ•°æ®åº“ Trigger/RLS ä¸­ã€‚
- **æ”¹åŠ¨**: å°† `AIAnalysis`, `QuoteGenerator` ç­‰æ¨¡å—çš„é€»è¾‘è¿ç§»åˆ°åç«¯æœåŠ¡ã€‚ç¦ç”¨æ•°æ®åº“ RLSï¼Œæ”¹ç”±æœåŠ¡å±‚æ§åˆ¶æƒé™ã€‚
- **ç›®çš„**: æ”¶æ‹¢ä¸šåŠ¡é€»è¾‘ï¼Œå®ç°çœŸæ­£çš„åç«¯æœåŠ¡åŒ–ã€‚

**Stage 3: é¢†åŸŸæ‹†åˆ† (å¾®æœåŠ¡åŒ–)**

- **ç°çŠ¶**: 12 å¼ è¡¨å…¨éƒ¨åœ¨ `public` schema ä¸‹ï¼Œå¼ºå¤–é”®å…³è”ã€‚
- **æ”¹åŠ¨**:
  - **æ‹†åˆ†æœåŠ¡**: User Service, Case Service, Search Service, AI Serviceã€‚
  - **æ‹†åˆ†æ•°æ®åº“**: æ¯ä¸ªæœåŠ¡æ‹¥æœ‰ç‹¬ç«‹çš„ Database/Schemaã€‚
  - **å»é™¤å¤–é”®**: è·¨æœåŠ¡æ•°æ®é€šè¿‡ API æˆ–æ¶ˆæ¯é˜Ÿåˆ—åŒæ­¥ï¼Œä¸å†ä¾èµ–æ•°æ®åº“çº§å¤–é”®ã€‚
- **ç›®çš„**: ç‹¬ç«‹éƒ¨ç½²ã€ç‹¬ç«‹æ‰©å®¹ã€æŠ€æœ¯æ ˆå¼‚æ„ã€‚

### 15.2 æ ¸å¿ƒæ”¹é€ ç‚¹è¯„ä¼°

| æ”¹é€ é¢†åŸŸ     | ç°çŠ¶                     | ç›®æ ‡å¾®æœåŠ¡æ¶æ„             | æ”¹åŠ¨éš¾åº¦                     |
| :----------- | :----------------------- | :------------------------- | :--------------------------- |
| **API é€šä¿¡** | ç›´æ¥ SQL/REST (Supabase) | gRPC / RESTful Gateway     | â­â­â­â­â­ (å®Œå…¨é‡å†™ API å±‚) |
| **æ•°æ®åº“**   | é›†ä¸­å¼ PostgreSQL        | åˆ†å¸ƒå¼æ•°æ®åº“ / ç‹¬ç«‹ Schema | â­â­â­â­ (æ‹†è¡¨ã€æ•°æ®è¿ç§»)    |
| **æƒé™æ§åˆ¶** | RLS (æ•°æ®åº“çº§)           | API Gateway + OAuth2/JWT   | â­â­â­ (è¿ç§»æƒé™é€»è¾‘)        |
| **äº‹åŠ¡ç®¡ç†** | æ•°æ®åº“æœ¬åœ°äº‹åŠ¡           | åˆ†å¸ƒå¼äº‹åŠ¡ (Saga/TCC)      | â­â­â­â­â­ (å¤„ç†ä¸€è‡´æ€§éš¾é¢˜)  |
| **å‰ç«¯ä»£ç ** | ä¾èµ– `supabase-js`       | ä¾èµ–è‡ªç ” API Client        | â­â­â­ (æ›¿æ¢æ‰€æœ‰æ•°æ®è¯·æ±‚)    |

### 15.3 å»ºè®®

**å½“å‰é˜¶æ®µå»ºè®®**:

1. **ä¿æŒç°çŠ¶**ã€‚ç›®å‰çš„ä¸šåŠ¡è§„æ¨¡ï¼ˆVue + Supabaseï¼‰æ˜¯å¼€å‘æ•ˆç‡æœ€é«˜çš„æ¨¡å¼ã€‚
2. **é€»è¾‘éš”ç¦»**ã€‚åœ¨å‰ç«¯ä»£ç ä¸­ï¼Œä¸¥æ ¼åŒºåˆ† `View` å±‚å’Œ `Service` å±‚ï¼Œå°†æ¥è¿ç§»æ—¶åªéœ€é‡å†™ `Service` å±‚å®ç°ã€‚
3. **æ··åˆæ¨¡å¼**ã€‚å¯¹äºå¤æ‚çš„è®¡ç®—å¯†é›†å‹ä»»åŠ¡ï¼ˆå¦‚ AI åˆ†æï¼‰ï¼Œä¼˜å…ˆå¼€å‘ç‹¬ç«‹çš„ Python å¾®æœåŠ¡ï¼Œé€šè¿‡ Supabase Edge Functions è°ƒç”¨ï¼Œé€æ­¥å°è¯•å¾®æœåŠ¡åŒ–ã€‚

---

---

## 16. é«˜å¹¶å‘ä¸æµ·é‡æ•°æ®è§£å†³æ–¹æ¡ˆ (Scalability Strategy)

### 16.1 é«˜å¹¶å‘å¤„ç† (High Concurrency)

é’ˆå¯¹ PV è¾¾åˆ°ç™¾ä¸‡çº§ã€QPS è¾¾åˆ°ä¸‡çº§çš„é«˜å¹¶å‘åœºæ™¯ï¼Œç³»ç»Ÿéœ€å¼•å…¥å¤šçº§ç¼“å†²å±‚ï¼š

1.  **è¯»å†™åˆ†ç¦»**:
    - ä¸»åº“ (Master): å¤„ç†æ‰€æœ‰ INSERT/UPDATE/DELETE è¯·æ±‚ã€‚
    - ä»åº“ (Read Replicas): å¤„ç†æ‰€æœ‰ SELECT è¯·æ±‚ï¼Œæ”¯æŒæ°´å¹³æ‰©å±•è‡³ 5+ èŠ‚ç‚¹ã€‚
2.  **å¤šçº§ç¼“å­˜æ¶æ„**:
    - **L1 æœ¬åœ°ç¼“å­˜**: ä½¿ç”¨ Guava/Caffeine ç¼“å­˜æçƒ­é…ç½®ï¼ˆå¦‚å“ç‰Œè®¾ç½®ã€Feature Flagsï¼‰ï¼ŒTTL 60ç§’ã€‚
    - **L2 åˆ†å¸ƒå¼ç¼“å­˜**: Redis Cluster ç¼“å­˜ç”¨æˆ· Sessionã€çƒ­é—¨æ¡ˆä¾‹ã€æ³•å¾‹æ³•è§„ï¼ŒTTL 1å°æ—¶ã€‚
    - **ç¼“å­˜ä¸€è‡´æ€§**: é‡‡ç”¨ Cache Aside æ¨¡å¼ï¼Œæ•°æ®åº“æ›´æ–°åå¼‚æ­¥å¤±æ•ˆç¼“å­˜ã€‚
3.  **å¼‚æ­¥å‰Šå³°**:
    - å¼•å…¥ RabbitMQ/Kafka å¤„ç†éå®æ—¶ä»»åŠ¡ï¼ˆå¦‚ AI æŠ¥å‘Šç”Ÿæˆã€æ—¥å¿—æŠ•é€’ã€ç«™å†…ä¿¡é€šçŸ¥ï¼‰ã€‚

### 16.2 é«˜å¯ç”¨ä¿éšœ (High Availability)

1.  **ç†”æ–­é™çº§ (Circuit Breaking)**:
    - å¼•å…¥ Sentinel æˆ– Hystrixã€‚
    - å½“æ³•ç¿ API å“åº”æ—¶é—´è¶…è¿‡ 3ç§’ æˆ– é”™è¯¯ç‡è¶…è¿‡ 50% æ—¶ï¼Œè‡ªåŠ¨ç†”æ–­ï¼Œè¿”å›é¢„è®¾çš„å…œåº•æ•°æ®æˆ–ç©ºç»“æœï¼Œé˜²æ­¢çº§è”æ•…éšœã€‚
2.  **é™æµä¿æŠ¤ (Rate Limiting)**:
    - ç½‘å…³å±‚ (Nginx/Gateway) é’ˆå¯¹ IP è¿›è¡Œæ¼æ¡¶é™æµã€‚
    - ä¸šåŠ¡å±‚é’ˆå¯¹ UserID è¿›è¡Œä»¤ç‰Œæ¡¶é™æµï¼Œé˜²æ­¢æ¶æ„åˆ·æ¥å£ã€‚
3.  **å¼‚åœ°å¤šæ´» (Geo-Redundancy)**:
    - æ ¸å¿ƒæ•°æ®åº“è·¨ AZ (å¯ç”¨åŒº) éƒ¨ç½²ï¼Œå®ç° RPOâ‰ˆ0 çš„å®¹ç¾åˆ‡æ¢ã€‚

### 16.3 æµ·é‡æ•°æ®ä¸æ•°æ®åº“ä¼˜åŒ–

1.  **åˆ†åº“åˆ†è¡¨ (Sharding)**:
    - **ç­–ç•¥**: ä½¿ç”¨ ShardingSphere æˆ– Citusã€‚
    - **æ°´å¹³åˆ†è¡¨**: å½“å•è¡¨è¶…è¿‡ 1000ä¸‡ è¡Œæ—¶ï¼Œå¯¹ `cases` è¡¨æŒ‰ `created_at` (å¹´/æœˆ) è¿›è¡Œ Range åˆ†åŒºï¼Œæˆ–æŒ‰ `user_id` è¿›è¡Œ Hash åˆ†è¡¨ã€‚
    - **å‚ç›´åˆ†åº“**: å°† `evidence` (å¤§å­—æ®µã€é«˜ I/O) ç‹¬ç«‹æ‹†åˆ†åˆ°å¯¹è±¡å­˜å‚¨ + å…ƒæ•°æ®è¡¨ã€‚
2.  **ç´¢å¼•ä¼˜åŒ–**:
    - å¼ºåˆ¶æ‰€æœ‰æŸ¥è¯¢èµ°ç´¢å¼•ã€‚
    - å¼•å…¥è¦†ç›–ç´¢å¼• (Covering Index) å‡å°‘å›è¡¨ã€‚
    - ç›‘æ§æ…¢æŸ¥è¯¢ (Slow Query Log)ï¼Œå®šæœŸä¼˜åŒ–æ‰§è¡Œè®¡åˆ’ (Explain)ã€‚
3.  **æœç´¢å¼•æ“å¸è½½**:
    - æ‰€æœ‰çš„æ¨¡ç³ŠæŸ¥è¯¢ (`LIKE %keyword%`) è¿ç§»è‡³ Elasticsearch / OpenSearchã€‚
    - æ•°æ®åº“åªæ‰¿æ‹…ä¸»é”®æŸ¥è¯¢å’Œç²¾ç¡®åŒ¹é…æŸ¥è¯¢ã€‚

---

## 17. å…¨é¢ä¼ä¸šçº§æ¶æ„è§„åˆ’ (Enterprise Roadmap)

> ç›®æ ‡ï¼šå°†ç°æœ‰çš„ Monolithic-BaaS æ¼”è¿›ä¸º Cloud-Native Microservices æ¶æ„ã€‚

### 17.1 é¢†åŸŸé©±åŠ¨è®¾è®¡ (DDD)

é‡æ„ç³»ç»Ÿè¾¹ç•Œï¼ŒæŒ‰ç…§ä¸šåŠ¡é¢†åŸŸ (Bounded Context) åˆ’åˆ†æœåŠ¡ï¼š

| é™ç•Œä¸Šä¸‹æ–‡                 | æ ¸å¿ƒå®ä½“ (Aggregates)              | èŒè´£                            |
| :------------------------- | :--------------------------------- | :------------------------------ |
| **ç”¨æˆ·åŸŸ (User Context)**  | User, Profile, Role, Permission    | è®¤è¯é‰´æƒã€ç»„ç»‡æ¶æ„ã€RBAC        |
| **æ¡ˆä»¶åŸŸ (Case Context)**  | Case, Party, Evidence, Timeline    | æ¡ˆä»¶å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†              |
| **æ³•å¾‹åŸŸ (Legal Context)** | Statute, Precedent, LegalConcept   | æ³•è§„åº“ç»´æŠ¤ã€åˆ¤ä¾‹åº“åŒæ­¥          |
| **æ™ºèƒ½åŸŸ (AI Context)**    | AnalysisReport, Quote, ChatSession | æ¨¡å‹æ¨ç†ã€RAG æ£€ç´¢ã€Prompt ç®¡ç† |
| **æ–‡æ¡£åŸŸ (Doc Context)**   | Document, Template, Approval       | æ–‡ä»¶å­˜å‚¨ã€ç‰ˆæœ¬æ§åˆ¶ã€åœ¨çº¿ç¼–è¾‘    |

### 17.2 å¾®æœåŠ¡æ²»ç†ä½“ç³»

å¼•å…¥ **Spring Cloud Alibaba** æˆ– **Go-Micro** ç­‰å¾®æœåŠ¡ç”Ÿæ€ï¼š

1.  **æœåŠ¡æ³¨å†Œä¸å‘ç°**: Nacos / Consulã€‚æ‰€æœ‰æœåŠ¡å¯åŠ¨æ—¶è‡ªåŠ¨æ³¨å†ŒåŠå…¶å¥åº·çŠ¶æ€ã€‚
2.  **é…ç½®ä¸­å¿ƒ**: Nacos / Apolloã€‚åŠ¨æ€ä¸‹å‘ Feature Flags å’Œ AI æ¨¡å‹å‚æ•°ï¼Œæ— éœ€é‡å¯æœåŠ¡ã€‚
3.  **é“¾è·¯è¿½è¸ª**: SkyWalking / Jaegerã€‚ç”Ÿæˆå…¨å±€è°ƒç”¨æ‹“æ‰‘å›¾ï¼Œå¿«é€Ÿå®šä½ API è€—æ—¶ç“¶é¢ˆ (å¦‚: Gateway -> Case Service -> Redis -> DB)ã€‚
4.  **API ç½‘å…³**: Spring Cloud Gateway / Envoyã€‚ç»Ÿä¸€æ¥å…¥é‰´æƒã€è·¯ç”±è½¬å‘ã€ç°åº¦å‘å¸ƒ (Canary Release)ã€‚

### 17.3 æ¶ˆæ¯é˜Ÿåˆ—ä¸äº‹ä»¶é©±åŠ¨ (Event-Driven)

è§£è€¦æœåŠ¡é—´å¼ºä¾èµ–ï¼Œå®ç°æœ€ç»ˆä¸€è‡´æ€§ï¼š

- **åœºæ™¯ 1 (æ¡ˆä»¶åˆ›å»º)**: Case Service åˆ›å»ºæ¡ˆä»¶æˆåŠŸ -> å‘é€ `case.created` äº‹ä»¶ -> AI Service è®¢é˜…å¹¶å¼€å§‹åå°åˆ†æé£é™©ã€‚
- **åœºæ™¯ 2 (çŠ¶æ€å˜æ›´)**: Case Service æ›´æ–°çŠ¶æ€ -> å‘é€ `case.status_changed` -> Doc Service è®¢é˜…å¹¶è‡ªåŠ¨å½’æ¡£æ–‡ä¹¦ã€‚

### 17.4 äº‘åŸç”Ÿä¸å®¹å™¨åŒ– (Cloud Native)

1.  **å®¹å™¨åŒ–**:
    - ç¼–å†™ Dockerfileï¼Œç»Ÿä¸€æ„å»ºé•œåƒã€‚
    - éµå¾ª 12-Factor App åŸåˆ™ã€‚
2.  **K8s ç¼–æ’**:
    - ä½¿ç”¨ Deployment ç®¡ç†æ— çŠ¶æ€æœåŠ¡ (API)ã€‚
    - ä½¿ç”¨ StatefulSet ç®¡ç†æœ‰çŠ¶æ€æœåŠ¡ (Middleware)ã€‚
    - HPA (Horizontal Pod Autoscaler): æ ¹æ® CPU/å†…å­˜æŒ‡æ ‡è‡ªåŠ¨ä¼¸ç¼© Pod æ•°é‡ã€‚
3.  **CI/CD æµæ°´çº¿**:
    - GitLab CI / Jenkins + ArgoCDã€‚
    - ä»£ç æäº¤ -> å•å…ƒæµ‹è¯• -> æ„å»ºé•œåƒ -> éƒ¨ç½² Dev -> è‡ªåŠ¨åŒ–é›†æˆæµ‹è¯• -> éƒ¨ç½² Prodã€‚

---

## 18. æœªæ¥è§„åˆ’

### 18.1 v3.4 è®¡åˆ’

- [ ] è¯æ®æ—¶é—´è½´ç¼–è¾‘å™¨
- [ ] æ–‡ä»¶é¢„è§ˆåŠŸèƒ½
- [ ] è·¯ç”±å®ˆå«å¢å¼º
- [ ] ç”¨æˆ·èµ„æ–™æ‰©å±•

### 15.2 v4.0 æ„¿æ™¯

- [ ] å›¢é˜Ÿåä½œåŠŸèƒ½
- [ ] æƒé™ç®¡ç†ç³»ç»Ÿ
- [ ] åç«¯ API æœåŠ¡
- [ ] æ•°æ®åˆ†æçœ‹æ¿
- [ ] ç§»åŠ¨ç«¯é€‚é…

### 15.3 æŠ€æœ¯æ¼”è¿›

- [ ] è¿ç§»åˆ° Vue 3 + Vite æ„å»º
- [ ] TypeScript é‡æ„
- [ ] å¾®å‰ç«¯æ¶æ„
- [ ] GraphQL API

### 18.2 æˆ˜ç•¥æ„¿æ™¯ï¼šæ³•å¾‹å‚åŸŸ AI Agent (Vertical AI Agent Vision)

> **å¯¹æ ‡äº§å“**: èš‚èšé˜¿ç¦ (åŒ»ç–—å¥åº· AI)
> **æ„¿æ™¯ç›®æ ‡**: æ‰“é€ æ³•å¾‹ç•Œçš„ "èš‚èšé˜¿ç¦" â€”â€” ä» "æ¡ˆä»¶ç®¡ç†å·¥å…·" è¿›åŒ–ä¸º "æ‡‚æ³•å¾‹çš„ AI ä¼™ä¼´"ã€‚

æˆ‘ä»¬ä¸ä»…æ˜¯ä¸€ä¸ª SaaS å·¥å…·ï¼Œæ›´è‡´åŠ›äºæˆä¸ºå¾‹å¸ˆçš„ **AI åˆ†èº«**ã€‚æ­£å¦‚èš‚èšé˜¿ç¦é€šè¿‡ AI è¿æ¥ç”¨æˆ·ä¸å¥åº·æœåŠ¡ï¼Œæˆ‘ä»¬å°†é€šè¿‡ AI è¿æ¥å¾‹å¸ˆä¸æ¡ˆä»¶æ•°æ®ã€‚

1.  **äº§å“å½¢æ€æ¼”è¿›**:
    - **V1 (å·¥å…·å±æ€§)**: æ¡ˆä»¶å½•å…¥ã€æ£€ç´¢ã€‚
    - **V2 (åŠ©æ‰‹å±æ€§)**: AI æ‘˜è¦ã€AI ç¿»è¯‘ã€ç®€å•çš„é—®ç­”ã€‚
    - **V3 (Agent å±æ€§ - å½“å‰ç›®æ ‡)**:
      - **ä¸»åŠ¨æ„ŸçŸ¥**: ç³»ç»Ÿè‡ªåŠ¨ç›‘æ§æ¡ˆä»¶é˜¶æ®µ (Case Stage)ï¼Œä¸»åŠ¨æç¤º "å†è¿‡3å¤©æ˜¯ä¸¾è¯æœŸé™ï¼Œè¯·è¡¥å……è¯æ®"ã€‚
      - **æ·±åº¦æ€è€ƒ**: ç»“åˆ **Dify + RAGFlow**ï¼Œä¸ä»…åŸºäºæ³•æ¡å›ç­”ï¼Œæ›´èƒ½æ·±åº¦ç†è§£å‡ ç™¾é¡µçš„æ¡ˆä»¶å·å®—ï¼Œç»™å‡º "æœ¬æ¡ˆèƒœè¯‰ç‡ 70%ï¼Œé£é™©ç‚¹åœ¨åˆåŒç¬¬12æ¡" è¿™ç§ä¸“å®¶çº§å»ºè®®ã€‚
    - **V4 (åˆ†èº«å±æ€§ - æœªæ¥)**: è¿™é‡Œçš„ AI å¯ä»¥ç‹¬ç«‹å®Œæˆ "å†™èµ·è¯‰çŠ¶ -> æäº¤å®¡æ‰¹ -> å‘é€å®¢æˆ·" çš„å…¨è‡ªåŠ¨é—­ç¯ã€‚

2.  **ä¸ºä»€ä¹ˆé€‰æ‹©æ··åˆäº‘æ¶æ„ (Why Hybrid Cloud)?**
    - **éšç§å£å’ (Privacy First)**: å°±åƒåŒ»ç–—æ•°æ®ä¸€æ ·ï¼Œæ³•å¾‹å·å®—æ˜¯å¾‹æ‰€çš„æ ¸å¿ƒèµ„äº§ï¼Œç»ä¸èƒ½é€šè¿‡å…¬æœ‰äº‘ AI å¤„ç†ã€‚æˆ‘ä»¬çš„ **PVE + æœ¬åœ°åŒ– RAGFlow** æ–¹æ¡ˆï¼Œç¡®ä¿æ‰€æœ‰æ•æ„Ÿæ¨ç† (Inference) éƒ½åœ¨å¾‹æ‰€æœ¬åœ°å®Œæˆï¼Œæ•°æ®ä¸å‡ºé—¨ã€‚
    - **ä¸“ä¸šå£å’ (Domain Expertise)**: é€šç”¨å¤§æ¨¡å‹ä¸æ‡‚ä¸­å›½æ³•å¾‹çš„ç»†å¾®å·®åˆ«ã€‚æˆ‘ä»¬éœ€è¦é€šè¿‡ RAGFlow æŒ‚è½½ TB çº§çš„ç§æœ‰è£åˆ¤æ–‡ä¹¦åº“ï¼Œè®­ç»ƒä¸“å±çš„ Embeddingï¼Œè¿™åªæœ‰åœ¨ç§æœ‰åŒ–å¼ºç®—åŠ›æœåŠ¡å™¨ä¸Šæ‰èƒ½ä½æˆæœ¬å®ç°ã€‚

---

## 19. åŸºç¡€è®¾æ–½èµ„æºè§„åˆ’ (Infrastructure Planning)

> åŸºäºç¬¬ 16ã€17 ç« çš„ä¼ä¸šçº§å¾®æœåŠ¡æ¶æ„ï¼Œä»¥ä¸‹æ˜¯ç”Ÿäº§ç¯å¢ƒçš„æœåŠ¡å™¨é‡‡è´­ä¸é…ç½®å»ºè®®ã€‚å»ºè®®é‡‡ç”¨ **äº‘æœåŠ¡ (Cloud)** æ¨¡å¼ä»¥é™ä½è¿ç»´æˆæœ¬ï¼Œè‹¥éœ€è‡ªå»ºæ•°æ®ä¸­å¿ƒ (On-Premise) è¯·å‚è€ƒä¸‹åˆ—ç‰©ç†é…ç½®ã€‚

### 19.1 èµ„æºé…ç½®æ–¹æ¡ˆ (åˆ†çº§å»ºè®®)

#### æ–¹æ¡ˆ Aï¼šæ ‡å‡†é«˜å¯ç”¨ç‰ˆ (Enterprise Production)

é€‚ç”¨äºæ¯æ—¥ PV > 100ä¸‡ï¼Œå¯¹ SLA è¦æ±‚ 99.99% çš„æ ¸å¿ƒä¸šåŠ¡åœºæ™¯ã€‚

| èµ„æºå±‚çº§     | ç»„ä»¶è§’è‰²               | æ¨èè§„æ ¼ (CPU/å†…å­˜/ç£ç›˜) | èŠ‚ç‚¹æ•° | ç”¨é€”è¯´æ˜                |
| :----------- | :--------------------- | :----------------------- | :----- | :---------------------- |
| **K8s é›†ç¾¤** | Control Plane (Master) | 4æ ¸ 8G 100G              | 3      | K8s é«˜å¯ç”¨æ§åˆ¶å¹³é¢      |
|              | Worker Node (ä¸šåŠ¡)     | 8æ ¸ 16G 200G             | 3+     | è¿è¡Œ User/Case ç­‰å¾®æœåŠ¡ |
|              | Worker Node (AI)       | 16æ ¸ 32G (å¯é€‰ T4 GPU)   | 2+     | è¿è¡Œ AI æ¨ç†ã€OCR æœåŠ¡  |
| **æ•°æ®å­˜å‚¨** | PostgreSQL (ä¸»/ä»)     | 16æ ¸ 32G NVMe SSD        | 2      | åˆ†ç¦»è¯»å†™ï¼Œæ ¸å¿ƒäº¤æ˜“åº“    |
|              | Redis Cluster          | 4æ ¸ 8G                   | 6      | 3ä¸»3ä»ï¼ŒæŠ—é«˜å¹¶å‘ç¼“å­˜    |
|              | Elasticsearch          | 8æ ¸ 32G                  | 3      | æ—¥å¿—æ”¶é›†ä¸å…¨æ–‡æ£€ç´¢      |
| **ä¸­é—´ä»¶**   | RocketMQ / Kafka       | 8æ ¸ 16G                  | 3      | æ¶ˆæ¯é˜Ÿåˆ—é›†ç¾¤            |
|              | Nacos / Consul         | 4æ ¸ 8G                   | 3      | æ³¨å†Œä¸­å¿ƒä¸é…ç½®ä¸­å¿ƒ      |
| **ç½‘å…³ç›‘æ§** | Gateway / Nginx        | 8æ ¸ 16G                  | 2      | æµé‡å…¥å£ï¼Œé«˜æ€§èƒ½ç½‘å…³    |
|              | Ops (Prometheus/Sky)   | 8æ ¸ 32G 500G             | 1      | ç›‘æ§ã€é“¾è·¯è¿½è¸ªå­˜å‚¨      |

**æ€»èµ„æºé¢„ä¼°**: çº¦ 200 vCPU, 400GB RAMã€‚æœˆæˆæœ¬é¢„ä¼°è¾ƒé«˜ï¼Œå»ºè®®ä½¿ç”¨äº‘æ‰˜ç®¡æœåŠ¡ (RDS, ACK/EKS) æ›¿ä»£è‡ªå»ºç»„ä»¶ã€‚

#### æ–¹æ¡ˆ Bï¼šèµ·æ­¥ç²¾ç®€ç‰ˆ (Startup MVP)

é€‚ç”¨äºä¸šåŠ¡åˆæœŸï¼Œæ—¥ PV < 10ä¸‡ï¼Œè¿½æ±‚æ€§ä»·æ¯”ã€‚

| ç»„ä»¶          | éƒ¨ç½²æ–¹å¼   | æ¨èè§„æ ¼        | èŠ‚ç‚¹æ•° | è¯´æ˜                               |
| :------------ | :--------- | :-------------- | :----- | :--------------------------------- |
| **K8s (K3s)** | æ··åˆéƒ¨ç½²   | 8æ ¸ 16G         | 3      | Master/Worker æ··éƒ¨ï¼Œè¿è¡Œæ‰€æœ‰å¾®æœåŠ¡ |
| **æ•°æ®åº“**    | äº‘ RDS     | 4æ ¸ 8G          | 1      | è´­ä¹°é«˜å¯ç”¨ç‰ˆ RDSï¼Œçœå»è¿ç»´         |
| **Redis**     | äº‘ Redis   | 2G ä¸»ä»ç‰ˆ       | 1      | åŸºç¡€ç¼“å­˜éœ€æ±‚                       |
| **ä¸­é—´ä»¶**    | å®¹å™¨åŒ–éƒ¨ç½² | (å…±äº« K8s èµ„æº) | -      | Nacos/MQ éƒ¨ç½²åœ¨ K8s å†…ï¼Œå•èŠ‚ç‚¹è¿è¡Œ |
| **ç½‘å…³**      | Ingress    | (å…±äº« K8s èµ„æº) | -      | ä½¿ç”¨ K8s Ingress Controller        |

### 19.2 ç½‘ç»œä¸å­˜å‚¨è§„åˆ’

1.  **ç½‘ç»œè§„åˆ’**:
    - **VPC**: åˆ’åˆ† `DMZ` (ç½‘å…³å±‚), `App` (åº”ç”¨å±‚), `Data` (æ•°æ®å±‚) ä¸‰ä¸ªå­ç½‘ã€‚
    - **å¸¦å®½**: å…¬ç½‘å…¥å£å»ºè®® 20Mbps+ï¼Œé…åˆ CDN åˆ†å‘é™æ€èµ„æº (OSS)ã€‚
2.  **å­˜å‚¨ç­–ç•¥**:
    - **å¯¹è±¡å­˜å‚¨ (OSS/S3)**: æ‰€æœ‰çš„è¯æ®æ–‡ä»¶ã€åˆåŒæ–‡æ¡£ã€å›¾ç‰‡å¿…é¡»ä¸Šäº‘ï¼Œç¦æ­¢å­˜æ”¾åœ¨æœåŠ¡å™¨æœ¬åœ°ç£ç›˜ã€‚
    - **NAS/PVC**: K8s è®¾ç½®å…±äº«å­˜å‚¨ç±» (StorageClass)ï¼Œç”¨äºæ—¥å¿—æŒ‚è½½å’Œæœ‰çŠ¶æ€æœåŠ¡æ•°æ®æŒä¹…åŒ–ã€‚

#### æ–¹æ¡ˆ Cï¼šæ··åˆäº‘ AI å¢å¼ºç‰ˆ (Hybrid Cloud AI)

é€‚ç”¨äºæ•°æ®åœ¨äº‘ç«¯ (Supabase)ï¼Œä½†éœ€è¦æœ¬åœ°å¼ºç®—åŠ›æ”¯æŒç§æœ‰åŒ– AI (Dify + RAGFlow) çš„åœºæ™¯ã€‚

- **äº‘ç«¯ (Data Layer)**: Supabase SaaS (å…è¿ç»´ï¼Œé«˜å¯ç”¨)ã€‚
- **æœ¬åœ° (Compute Layer)**: è‡ªå»ºé«˜æ€§èƒ½æœåŠ¡å™¨ï¼Œé€šè¿‡ PVE è™šæ‹ŸåŒ–ç®¡ç†ã€‚

**æœ¬åœ°ç‰©ç†æœºæ¨èé…ç½®**:

- **CPU**: AMD EPYC / Intel Xeon (24æ ¸ä»¥ä¸Š)
- **å†…å­˜**: 128GB DDR4/DDR5 ECC (å…³é”®æŒ‡æ ‡ï¼ŒRAGFlow æåƒå†…å­˜)
- **ç¡¬ç›˜**: 2TB NVMe SSD (å‘é‡åº“é«˜é€Ÿè¯»å†™)
- **æ˜¾å¡**: NVIDIA RTX 3090 / 4090 (24Gæ˜¾å­˜ï¼Œç”¨äºæœ¬åœ° LLM/Embedding æ¨ç†)

**æœ¬åœ°èµ„æºåˆ†é… (PVE)**:

| VM åç§°          | èµ„æºåˆ†é… | è¿è¡ŒæœåŠ¡          | è¯´æ˜                                   |
| :--------------- | :------- | :---------------- | :------------------------------------- |
| `VM-1 (AI-Core)` | 16æ ¸ 64G | RAGFlow (Docker)  | æ ¸å¿ƒçŸ¥è¯†åº“å¼•æ“ (ES, OCR, DeepDoc)      |
| `VM-2 (Agent)`   | 8æ ¸ 16G  | Dify (Docker)     | Agent ç¼–æ’ï¼Œå·¥ä½œæµå¼•æ“                 |
| `VM-3 (Vector)`  | 8æ ¸ 32G  | Milvus / Weaviate | ç‹¬ç«‹å‘é‡æ•°æ®åº“ (å¯é€‰ï¼ŒRAGFlow è‡ªå¸¦ ES) |

### 19.3 è™šæ‹ŸåŒ–ä¸å®¹å™¨åŒ–ç­–ç•¥ (PVE + Docker)

é’ˆå¯¹æœ¬åœ°è‡ªå»ºç®—åŠ›ï¼Œé‡‡ç”¨ **"åº•å±‚è™šæ‹ŸåŒ– + ä¸Šå±‚å®¹å™¨åŒ–"** çš„åˆ†å±‚æ²»ç†ç­–ç•¥ï¼š

1.  **IaaS å±‚ (PVE)**:
    - ä½¿ç”¨ **Proxmox VE** ç®¡ç†ç‰©ç†ç¡¬ä»¶ã€‚
    - ä¼˜åŠ¿ï¼šç¡¬ä»¶éš”ç¦»ã€‚å½“ RAGFlow çš„ Elasticsearch æŠŠå†…å­˜åƒå…‰æ—¶ï¼Œç³»ç»Ÿ OOM ä¸ä¼šå½±å“åˆ° Dify æ‰€åœ¨çš„è™šæ‹Ÿæœºã€‚
    - è¿ç»´ï¼šåˆ©ç”¨ PVE çš„ Snapshot åŠŸèƒ½ï¼Œåœ¨ç³»ç»Ÿå‡çº§å‰ä¸€é”®å¿«ç…§ï¼Œéšæ—¶å›æ»šã€‚

2.  **PaaS å±‚ (Docker/K3s)**:
    - åœ¨ PVE çš„è™šæ‹Ÿæœºå†…éƒ¨ï¼Œä½¿ç”¨ **Docker Compose** æˆ– **K3s** éƒ¨ç½²åº”ç”¨ã€‚
    - ä¼˜åŠ¿ï¼šåº”ç”¨äº¤ä»˜ã€‚Dify å’Œ RAGFlow å®˜æ–¹å‡æä¾› Docker Compose ä¸€é”®éƒ¨ç½²è„šæœ¬ï¼Œå¼€ç®±å³ç”¨ã€‚

3.  **å¼‚æ„ç½‘ç»œæ‰“é€š**:
    - **å†…ç½‘ç©¿é€**: ä½¿ç”¨ Cloudflare Tunnel æˆ– Frpï¼Œå°†æœ¬åœ° Dify çš„ API æš´éœ²ç»™å…¬ç½‘ Supabase ä½¿ç”¨ (Webhook å›è°ƒ)ã€‚
    - **æ•°æ®å®‰å…¨**: æœ¬åœ° AI æ¨ç†æ•°æ®ä¸å‡ºç½‘ï¼Œä»…è¿”å›è„±æ•åçš„åˆ†æç»“æœç»™äº‘ç«¯åº”ç”¨ã€‚

---

## 15. æœªæ¥è§„åˆ’

1. **AI èƒ½åŠ›æ·±åŒ–**:
   - å¼•å…¥æ›´å¤šæ³•å¾‹å‚ç›´é¢†åŸŸçš„ LLM æ¨¡å‹ã€‚
   - å¢å¼º RAG æ£€ç´¢çš„å‡†ç¡®æ€§å’Œä¸Šä¸‹æ–‡ç†è§£èƒ½åŠ›ã€‚
2. **ç§»åŠ¨ç«¯é€‚é…**:
   - å¼€å‘ç§»åŠ¨ç«¯å‹å¥½çš„ H5 æˆ–å°ç¨‹åºç‰ˆæœ¬ã€‚
3. **åä½œåŠŸèƒ½**:
   - æ”¯æŒå¤šäººååŒç¼–è¾‘æ–‡ä¹¦ã€‚
   - å¢åŠ å›¢é˜Ÿæƒé™ç®¡ç†å’Œå®¡æ‰¹æµã€‚

---

## é™„å½•

### A. å¼€å‘è§„èŒƒ

å‚è€ƒæ–‡æ¡£:

- [å‰ç«¯å¼€å‘è§„èŒƒ](../æŠ€æœ¯æ–‡æ¡£/å‰ç«¯å¼€å‘è§„èŒƒ.md)
- [è®¾è®¡è§„èŒƒ](../æŠ€æœ¯æ–‡æ¡£/design-guidelines.md)

### B. API æ–‡æ¡£

å‚è€ƒæ–‡æ¡£:

- [é€šä¹‰æ³•ç¿-æ¡ˆä¾‹æ£€ç´¢APIå¯¹æ¥æ–‡æ¡£](../api/é€šä¹‰æ³•ç¿-æ¡ˆä¾‹æ£€ç´¢APIå¯¹æ¥æ–‡æ¡£.md)
- [é€šä¹‰æ³•ç¿-æ³•è§„æ£€ç´¢APIå¯¹æ¥æ–‡æ¡£](../api/é€šä¹‰æ³•ç¿-æ³•è§„æ£€ç´¢APIå¯¹æ¥æ–‡æ¡£.md)

### C. èµ„æºç›®å½•

å‚è€ƒç›®å½•: `docs/api/`

---

**æ–‡æ¡£ç»´æŠ¤è€…**: Alpha&Leader Legal Tech  
**è”ç³»æ–¹å¼**: [GitHub Issues](https://github.com/690925339/legal-workspace-v3/issues)
