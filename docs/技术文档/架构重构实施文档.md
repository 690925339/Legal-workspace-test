# æ¶æ„é‡æ„å®æ–½æ–‡æ¡£

> **æ–‡æ¡£çŠ¶æ€**: âœ… å·²å®Œæˆ  
> **åˆ›å»ºæ—¥æœŸ**: 2026-01-04  
> **æœ€åæ›´æ–°**: 2026-01-06 15:30  
> **å…³è”æ–‡æ¡£**: [æ¶æ„ç¼ºé™·åŠæ”¹è¿›è®¡åˆ’](./æ¶æ„ç¼ºé™·åŠæ”¹è¿›è®¡åˆ’.md) | [å¾®æœåŠ¡æ²»ç†æ–‡æ¡£](./å¾®æœåŠ¡æ²»ç†æ–‡æ¡£.md) | [æ¶æ„è®¾è®¡æ–‡æ¡£](./æ¶æ„è®¾è®¡æ–‡æ¡£.md)

## ğŸ“‹ ç›®å½•

- [1. æ‰§è¡Œæ¦‚è§ˆ](#1-æ‰§è¡Œæ¦‚è§ˆ)
- [2. å·²å®Œæˆå·¥ä½œ](#2-å·²å®Œæˆå·¥ä½œ)
- [3. å½“å‰è¿›åº¦](#3-å½“å‰è¿›åº¦)
- [4. ä¸‹ä¸€æ­¥è®¡åˆ’](#4-ä¸‹ä¸€æ­¥è®¡åˆ’)
- [5. è¯¦ç»†å®æ–½æ­¥éª¤](#5-è¯¦ç»†å®æ–½æ­¥éª¤)
- [6. é—®é¢˜è¿½è¸ª](#6-é—®é¢˜è¿½è¸ª)
- [7. æ£€æŸ¥æ¸…å•](#7-æ£€æŸ¥æ¸…å•)

---

## 1. æ‰§è¡Œæ¦‚è§ˆ

### 1.1 é¡¹ç›®ç›®æ ‡

å°† Legal Workspace v3 å‰ç«¯ä»ä¼ ç»Ÿ Options API + Template String æ¨¡å¼ï¼Œé‡æ„ä¸ºç°ä»£åŒ–çš„ Vue 3 SFC + Composition API + Feature-Based æ¶æ„ï¼Œå¹¶åšå¥½å¾®æœåŠ¡ BFF å¯¹æ¥å‡†å¤‡ã€‚

### 1.2 å®æ–½é˜¶æ®µ

```
Phase 1: åŸºç¡€è®¾æ–½ âœ…
  â””â”€ Phase 2: Auth è¯•ç‚¹ âœ…
      â””â”€ Phase 3: Case æ ¸å¿ƒ âœ…
          â””â”€ Phase 4: æ¸…ç†ä¸éªŒæ”¶ âœ…
```

### 1.3 å…³é”®é‡Œç¨‹ç¢‘

| é‡Œç¨‹ç¢‘                  | ç›®æ ‡æ—¥æœŸ   | çŠ¶æ€        | å®Œæˆåº¦ |
| ----------------------- | ---------- | ----------- | ------ |
| **M1: è·¯ç”±ç³»ç»Ÿé‡æ„**    | 2026-01-04 | âœ… å·²å®Œæˆ   | 100%   |
| **M2: å¸ƒå±€ä¸ Store**    | 2026-01-04 | âœ… å·²å®Œæˆ   | 100%   |
| **M3: CaseDetail ä¼˜åŒ–** | 2026-01-04 | âœ… å·²å®Œæˆ   | 100%   |
| **M4: ç›®å½•ç»“æ„è¿ç§»**    | 2026-01-04 | âœ… å·²å®Œæˆ   | 100%   |
| **M5: ç»„ä»¶ SFC åŒ–**     | 2026-01-04 | âœ… å·²å®Œæˆ   | 100%   |
| **M6: API Client å¢å¼º** | 2026-01-06 | âœ… å·²å®Œæˆ   | 100%   |
| **M7: BFF å¯¹æ¥å‡†å¤‡**    | 2026-01-06 | âœ… æ¨¡æ‹ŸéªŒè¯ | 100%   |

---

## 2. å·²å®Œæˆå·¥ä½œ

### 2.1 Phase 1: åŸºç¡€è®¾æ–½ âœ…

#### âœ… è·¯ç”±ç³»ç»Ÿé‡æ„

- [x] å®‰è£…å¹¶é…ç½® `vue-router`
- [x] åˆ›å»º `src/router/index.js` ä¸»è·¯ç”±é…ç½®
- [x] åˆ›å»º `src/router/guards.js` è·¯ç”±å®ˆå«
- [x] åˆ›å»ºæ¨¡å—åŒ–è·¯ç”±ï¼š
  - `src/router/modules/case.js`
  - `src/router/modules/auth.js`
  - `src/router/modules/legal-research.js`
  - `src/router/modules/system.js`
- [x] æ›´æ–°æ‰€æœ‰è§†å›¾æ–‡ä»¶çš„å¯¼å…¥è·¯å¾„ï¼ˆ`router.js` â†’ `@/router/index.js`ï¼‰
- [x] ä¿®å¤ Vue ç»„ä»¶ä¸­çš„è·¯ç”±è°ƒç”¨ï¼ˆ`router.push` â†’ `this.$router.push`ï¼‰

**æ–‡ä»¶æ¸…å•**:

```
src/router/
  â”œâ”€â”€ index.js              âœ… ä¸»è·¯ç”±é…ç½®
  â”œâ”€â”€ guards.js             âœ… è®¤è¯å®ˆå«
  â””â”€â”€ modules/
      â”œâ”€â”€ case.js           âœ… æ¡ˆä»¶è·¯ç”±
      â”œâ”€â”€ auth.js           âœ… è®¤è¯è·¯ç”±
      â”œâ”€â”€ legal-research.js âœ… æ³•å¾‹æ£€ç´¢è·¯ç”±
      â””â”€â”€ system.js         âœ… ç³»ç»Ÿè·¯ç”±
```

#### âœ… å¸ƒå±€ç³»ç»Ÿ

- [x] åˆ›å»º `src/layouts/AppLayout.vue`ï¼ˆä¸»åº”ç”¨å¸ƒå±€ï¼‰
- [x] åˆ›å»º `src/layouts/AuthLayout.vue`ï¼ˆè®¤è¯é¡µå¸ƒå±€ï¼‰
- [x] æ›´æ–° `src/components/layout/Sidebar.vue`ï¼ˆä¿®å¤äº‹ä»¶å¤„ç†å™¨è¯­æ³•ï¼‰

**æ–‡ä»¶æ¸…å•**:

```
src/layouts/
  â”œâ”€â”€ AppLayout.vue    âœ… ä¸»å¸ƒå±€
  â””â”€â”€ AuthLayout.vue  âœ… è®¤è¯å¸ƒå±€
```

#### âœ… è·¯å¾„åˆ«åé…ç½®

- [x] æ›´æ–° `vite.config.js`ï¼Œæ·»åŠ è·¯å¾„åˆ«åï¼š
  - `@` â†’ `src/`
  - `@layouts` â†’ `src/layouts/`
  - `@stores` â†’ `src/stores/`
  - `@features` â†’ `src/features/`ï¼ˆé¢„ç•™ï¼‰
  - `@shared` â†’ `src/shared/`ï¼ˆé¢„ç•™ï¼‰
  - `@services` â†’ `src/services/`ï¼ˆé¢„ç•™ï¼‰

#### âœ… Store ç³»ç»Ÿ

- [x] åˆ›å»º `src/stores/auth.js`ï¼ˆå“åº”å¼è®¤è¯ Storeï¼‰
- [x] æ›´æ–°æ‰€æœ‰æ–‡ä»¶ä¸­çš„ `authStore` å¯¼å…¥è·¯å¾„
- [x] ä¿®å¤ `authStore` è®¿é—®æ–¹å¼ï¼ˆ`authStore.user` â†’ `authStore.state.user`ï¼‰

**æ–‡ä»¶æ¸…å•**:

```
src/stores/
  â””â”€â”€ auth.js  âœ… è®¤è¯çŠ¶æ€ç®¡ç†
```

### 2.2 Phase 2: Auth è¯•ç‚¹ âœ…

#### âœ… è®¤è¯æ¨¡å—ä¼˜åŒ–

- [x] æ›´æ–° `src/views/Login.vue`ï¼ˆä½¿ç”¨ `this.$router`ï¼‰
- [x] æ›´æ–° `src/views/Register.vue`
- [x] æ›´æ–° `src/views/ForgotPassword.vue`
- [x] æ›´æ–° `src/views/UserProfile.js`ï¼ˆä¿®å¤ authStore å¯¼å…¥ï¼‰
- [x] æ›´æ–° `src/views/ProductFeedback.js`ï¼ˆä¿®å¤ authStore å¯¼å…¥ï¼‰

### 2.3 Phase 3: Case æ ¸å¿ƒ âœ…

#### âœ… CaseDetail.js ä¼˜åŒ–

- [x] ç§»é™¤é‡å¤ä»£ç ï¼ˆè¯æ®ã€å½“äº‹äººã€è´¢åŠ¡ç­‰ï¼‰
- [x] ç²¾ç®€æ–‡ä»¶å¤§å°ï¼š1451 è¡Œ â†’ ~150 è¡Œï¼ˆå‡å°‘ 90%ï¼‰
- [x] ç§»é™¤ç¡¬ç¼–ç æ•°æ®ï¼ˆ`evidenceAnalysis`, `evidenceFiles`, `stakeholders` ç­‰ï¼‰
- [x] ç§»é™¤å†—ä½™æ–¹æ³•ï¼ˆæ‰€æœ‰å­æ¨¡å—çš„ CRUD æ“ä½œï¼‰
- [x] ç§»é™¤å†—ä½™æ¨¡æ¿ï¼ˆæ‰€æœ‰å­æ¨¡å—çš„ UIï¼‰

**ä¼˜åŒ–æˆæœ**:

- ä»£ç è¡Œæ•°: 1451 â†’ 150 (-90%)
- é‡å¤æ•°æ®: å·²ç§»é™¤
- èŒè´£æ¸…æ™°: ä»…ä¿ç•™è·¯ç”±å¯¼èˆªå’Œé«˜çº§åŠŸèƒ½

#### âœ… ç›®å½•ç»“æ„è¿ç§»

- [x] åˆ›å»º `src/features/` å®Œæ•´ç›®å½•ç»“æ„
- [x] è¿ç§» Auth æ¨¡å—åˆ° `features/auth/`
- [x] è¿ç§» Case æ¨¡å—åˆ° `features/case/`
- [x] è¿ç§» Legal Research æ¨¡å—åˆ° `features/legal-research/`
- [x] è¿ç§» System æ¨¡å—åˆ° `features/system/`
- [x] æ›´æ–°æ‰€æœ‰è·¯ç”±é…ç½®æŒ‡å‘æ–°è·¯å¾„
- [x] ä¿®å¤æ‰€æœ‰å¯¼å…¥è·¯å¾„

**ç›®å½•ç»“æ„**:

```
src/features/
  â”œâ”€â”€ auth/views/         âœ… Login.vue, Register.vue, ForgotPassword.vue
  â”œâ”€â”€ case/
  â”‚   â”œâ”€â”€ views/           âœ… CaseList.vue, CaseForm.vue, EvidenceUpload.js
  â”‚   â””â”€â”€ modules/         âœ… 6 ä¸ªå­æ¨¡å— (SFC åŒ–å®Œæˆ)
  â”œâ”€â”€ legal-research/views/ âœ… LegalResearch.vue, CaseSearchResults.js, etc.
  â”œâ”€â”€ contract/views/      âœ… ContractReview.js, ContractReviewResult.js
  â”œâ”€â”€ document/views/      âœ… DocGenerate.js
  â””â”€â”€ system/views/        âœ… Settings.vue, ProductFeedback.vue, UserProfile.vue
```

#### âœ… ç»„ä»¶ SFC åŒ–

**System æ¨¡å—** (3 ä¸ªç»„ä»¶):

- [x] `Settings.js` â†’ `Settings.vue`
- [x] `ProductFeedback.js` â†’ `ProductFeedback.vue`
- [x] `UserProfile.js` â†’ `UserProfile.vue`

**Legal Research æ¨¡å—** (1 ä¸ªç»„ä»¶):

- [x] `LegalResearch.js` â†’ `LegalResearch.vue`

**Case å­æ¨¡å—** (6 ä¸ªç»„ä»¶):

- [x] `CaseBasicInfo.js` â†’ `CaseBasicInfo.vue` (583 è¡Œ)
- [x] `CaseFacts.js` â†’ `CaseFacts.vue` (117 è¡Œ)
- [x] `CaseStakeholders.js` â†’ `CaseStakeholders.vue` (466 è¡Œ)
- [x] `CaseFinancials.js` â†’ `CaseFinancials.vue` (293 è¡Œ)
- [x] `CaseEvidence.js` â†’ `CaseEvidence.vue` (308 è¡Œ)
- [x] `CaseAdvanced.js` â†’ `CaseAdvanced.vue` (91 è¡Œ)

**Contract æ¨¡å—** (2 ä¸ªç»„ä»¶):

- [x] `ContractReview.js` â†’ `ContractReview.vue`
- [x] `ContractReviewResult.js` â†’ `ContractReviewResult.vue`

**Document æ¨¡å—** (1 ä¸ªç»„ä»¶):

- [x] `DocGenerate.js` â†’ `DocGenerate.vue`

**SFC è½¬æ¢æ±‡æ€»**: 13 ä¸ªç»„ä»¶å·²å®Œæˆè½¬æ¢ï¼Œæ‰€æœ‰è·¯ç”±å·²æ›´æ–°

---

## 3. å½“å‰è¿›åº¦

### 3.1 æ•´ä½“å®Œæˆåº¦

```
åŸºç¡€è®¾æ–½:     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100%
Auth è¯•ç‚¹:    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100%
Case æ ¸å¿ƒ:    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100%
ç›®å½•è¿ç§»:     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100%
SFC è½¬æ¢:     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100%
API å¢å¼º:     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100%
æµ‹è¯•è¦†ç›–:     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100%
```

### 3.2 å½“å‰é˜¶æ®µä»»åŠ¡

**Phase 4: æ¸…ç†ä¸éªŒæ”¶** (å·²å®Œæˆ)

- [x] æ„å»º Mock BFF Server è¿›è¡Œä»£ç†æ¨¡å¼éªŒè¯
- [x] åˆ é™¤ `src/backup_legacy_code` å½’æ¡£ç›®å½•
- [x] ç¡®è®¤ `npm run build` æˆåŠŸ
- [x] æ–‡æ¡£æœ€ç»ˆæ›´æ–°

---

## 4. ä¸‹ä¸€æ­¥è®¡åˆ’

### 4.1 ç«‹å³æ‰§è¡Œï¼ˆæœ¬å‘¨ï¼‰

#### ğŸ”´ P0 - é«˜ä¼˜å…ˆçº§

1. **åˆ é™¤åŸå§‹ .js æ–‡ä»¶**
   - åˆ é™¤å·²è½¬æ¢çš„ `.js` è§†å›¾æ–‡ä»¶
   - çŠ¶æ€: âœ… å·²å®Œæˆ (Legacy files moved to src/backup_legacy_code)
   - é¢„è®¡: 0.5 å¤©

2. **Composables æŠ½å–**
   - åˆ›å»º `useCaseBasicInfo.js`, `useCaseStakeholders.js` ç­‰
   - æŠ½å–å¤ç”¨é€»è¾‘
   - çŠ¶æ€: âœ… å·²å®Œæˆ (CaseBasicInfo logic extracted)
   - é¢„è®¡: 1 å¤©

3. **æµè§ˆå™¨å…¨é¢æµ‹è¯•**
   - æµ‹è¯•æ‰€æœ‰é¡µé¢åŠŸèƒ½
   - ç¡®è®¤æ ·å¼ä¸€è‡´æ€§
   - çŠ¶æ€: âœ… å·²å®Œæˆ (Verified by User)
   - é¢„è®¡: 0.5 å¤©

#### ğŸŸ¡ P1 - ä¸­ä¼˜å…ˆçº§

4. **API Client å¢å¼º**
   - åˆ›å»º `src/services/api-client.js`
   - å®ç° JWT æ³¨å…¥ã€è¯·æ±‚å–æ¶ˆã€é”™è¯¯å¤„ç†
   - çŠ¶æ€: âœ… å·²å®Œæˆ (src/services/api-client.js implemented)
   - é¢„è®¡: 1.5 å¤©

5. **Service å±‚å°è£…**
   - åˆ›å»º `src/features/case/services/caseService.js`
   - å°è£… Supabase è°ƒç”¨
   - çŠ¶æ€: âœ… å·²å®Œæˆ (Services implemented in src/features/case/services/)
   - é¢„è®¡: 2 å¤©

### 4.2 è¿‘æœŸè®¡åˆ’ï¼ˆ2 å‘¨å†…ï¼‰

#### ğŸŸ¢ P2 - ä½ä¼˜å…ˆçº§

6. **AI Service æµå¼å®¢æˆ·ç«¯**
   - å®ç° SSE è§£æ
   - æ”¯æŒè¯·æ±‚å–æ¶ˆ
   - çŠ¶æ€: âœ… å·²å®Œæˆ (Implemented in api-client.js)
   - é¢„è®¡: 0.5 å¤©

7. **BatchLoader å®ç°**
   - è§£å†³ N+1 é—®é¢˜
   - çŠ¶æ€: âœ… å·²å®Œæˆ (src/utils/batch-loader.js implemented)
   - é¢„è®¡: 1 å¤©

8. **æµ‹è¯•è¦†ç›–**
   - Composables å•å…ƒæµ‹è¯•
   - Services å•å…ƒæµ‹è¯•
   - çŠ¶æ€: âœ… å·²å®Œæˆ (Added unit tests for Case modules)
   - é¢„è®¡: 2 å¤©

---

## 5. è¯¦ç»†å®æ–½æ­¥éª¤

### 5.1 ä¿®å¤å†å²è®°å½•æ¨¡æ€æ¡†

**é—®é¢˜æè¿°**: ç‚¹å‡»æ³•å¾‹æ£€ç´¢é¡µé¢çš„"å†å²è®°å½•"æŒ‰é’®ï¼Œæ¨¡æ€æ¡†æ— æ³•æ­£å¸¸æ˜¾ç¤ºã€‚

**æ’æŸ¥æ­¥éª¤**:

1. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯
2. æ£€æŸ¥ `HistoryModal.vue` ç»„ä»¶æ ·å¼
3. æ£€æŸ¥ `LegalResearch.js` ä¸­çš„äº‹ä»¶ç»‘å®š
4. æ£€æŸ¥ `faruiService.getSearchHistory()` æ–¹æ³•

**ä¿®å¤æ–¹æ¡ˆ**:

```bash
# 1. æ£€æŸ¥æ¨¡æ€æ¡†æ ·å¼æ˜¯å¦å®Œæ•´
# 2. æ£€æŸ¥äº‹ä»¶å¤„ç†å™¨æ˜¯å¦æ­£ç¡®
# 3. æ£€æŸ¥æ•°æ®åŠ è½½é€»è¾‘
```

**éªŒæ”¶æ ‡å‡†**:

- [x] ç‚¹å‡»"å†å²è®°å½•"æŒ‰é’®ï¼Œæ¨¡æ€æ¡†æ­£å¸¸æ˜¾ç¤º
- [x] å†å²è®°å½•åˆ—è¡¨æ­£å¸¸åŠ è½½
- [x] ç‚¹å‡»å†å²è®°å½•é¡¹ï¼Œèƒ½æ­£ç¡®å¡«å……æœç´¢æ¡†
- [x] åˆ é™¤å†å²è®°å½•åŠŸèƒ½æ­£å¸¸

---

### 5.2 ç›®å½•ç»“æ„è¿ç§»

**ç›®æ ‡**: å»ºç«‹ Feature-Based ç›®å½•ç»“æ„

**æ­¥éª¤ 1: åˆ›å»ºç›®å½•éª¨æ¶**

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ
mkdir -p src/features/case/views
mkdir -p src/features/case/modules/basic
mkdir -p src/features/case/modules/facts
mkdir -p src/features/case/modules/stakeholder
mkdir -p src/features/case/modules/evidence
mkdir -p src/features/case/modules/financial
mkdir -p src/features/case/modules/analysis
mkdir -p src/features/case/components
mkdir -p src/features/case/composables
mkdir -p src/features/case/services

mkdir -p src/features/auth/views
mkdir -p src/features/auth/composables
mkdir -p src/features/auth/services

mkdir -p src/features/legal-research/views
mkdir -p src/features/legal-research/composables
mkdir -p src/features/legal-research/services

mkdir -p src/shared/components
mkdir -p src/shared/composables
mkdir -p src/shared/utils
mkdir -p src/shared/constants
```

**æ­¥éª¤ 2: è¿ç§» Case æ¨¡å—**

```bash
# è¿ç§»è§†å›¾
mv src/views/CaseList.vue src/features/case/views/
mv src/views/CaseDetail.js src/features/case/views/CaseDetail.vue  # å¾… SFC åŒ–
mv src/views/case/* src/features/case/modules/

# è¿ç§»ç»„ä»¶
mv src/components/case/* src/features/case/components/ 2>/dev/null || true
```

**æ­¥éª¤ 3: æ›´æ–°å¯¼å…¥è·¯å¾„**

```bash
# å…¨å±€æœç´¢æ›¿æ¢
# from '@/views/CaseList' â†’ from '@/features/case/views/CaseList'
# from '../views/case/' â†’ from '@/features/case/modules/'
```

**æ­¥éª¤ 4: æ›´æ–°è·¯ç”±é…ç½®**

```javascript
// src/router/modules/case.js
export default [
  {
    path: '',
    name: 'CaseList',
    component: () => import('@/features/case/views/CaseList.vue'),
    meta: { title: 'æ¡ˆä»¶åˆ—è¡¨' }
  }
  // ...
]
```

**éªŒæ”¶æ ‡å‡†**:

- [ ] æ‰€æœ‰ç›®å½•åˆ›å»ºæˆåŠŸ
- [ ] æ–‡ä»¶è¿ç§»å®Œæˆ
- [ ] å¯¼å…¥è·¯å¾„æ›´æ–°å®Œæˆ
- [ ] `npm run dev` æ­£å¸¸è¿è¡Œ
- [ ] æ¡ˆä»¶åˆ—è¡¨å’Œè¯¦æƒ…é¡µåŠŸèƒ½æ­£å¸¸

---

### 5.3 ç»„ä»¶ SFC åŒ–

**ç›®æ ‡**: å°† `.js` ç»„ä»¶è½¬æ¢ä¸º `.vue` SFC

**æ­¥éª¤ 1: CaseDetail.js â†’ CaseDetail.vue**

```bash
# 1. åˆ›å»ºæ–°æ–‡ä»¶
touch src/features/case/views/CaseDetail.vue

# 2. è¿ç§»æ¨¡æ¿éƒ¨åˆ†
# å°† template å­—ç¬¦ä¸²ç§»åˆ° <template> æ ‡ç­¾

# 3. è¿ç§»è„šæœ¬éƒ¨åˆ†
# å°† export default ç§»åˆ° <script setup> æˆ– <script>

# 4. è¿ç§»æ ·å¼éƒ¨åˆ†
# å°†å†…è”æ ·å¼ç§»åˆ° <style scoped>
```

**æ­¥éª¤ 2: UserProfile.js â†’ UserProfile.vue**

```bash
# åŒä¸Šæ­¥éª¤
```

**æ­¥éª¤ 3: å…¶ä»–æ ¸å¿ƒè§†å›¾**

- `LegalResearch.js` â†’ `LegalResearch.vue`
- `CaseSearchResults.js` â†’ `CaseSearchResults.vue`
- `RegulationSearchResults.js` â†’ `RegulationSearchResults.vue`

**éªŒæ”¶æ ‡å‡†**:

- [ ] æ‰€æœ‰ `.js` è§†å›¾å·²è½¬æ¢ä¸º `.vue`
- [ ] æ¨¡æ¿è¯­æ³•æ­£ç¡®
- [ ] æ ·å¼æ­£ç¡®åº”ç”¨
- [ ] åŠŸèƒ½å®Œå…¨æ­£å¸¸
- [ ] HMR çƒ­æ›´æ–°æ­£å¸¸

---

### 5.4 API Client å¢å¼º

**ç›®æ ‡**: åˆ›å»ºç»Ÿä¸€çš„ API å®¢æˆ·ç«¯ï¼Œæ”¯æŒ JWTã€å–æ¶ˆã€é”™è¯¯å¤„ç†

**æ­¥éª¤ 1: åˆ›å»º API Client**

```bash
touch src/services/api-client.js
```

**æ­¥éª¤ 2: å®ç°æ ¸å¿ƒåŠŸèƒ½**

å‚è€ƒ `docs/æ¶æ„ç¼ºé™·åŠæ”¹è¿›è®¡åˆ’.md` ç¬¬ 1.3 èŠ‚çš„ä»£ç ç¤ºä¾‹ã€‚

**æ­¥éª¤ 3: åˆ›å»ºé”™è¯¯å¤„ç†å™¨**

```bash
touch src/services/error-handler.js
```

**éªŒæ”¶æ ‡å‡†**:

- [ ] API Client æ”¯æŒ JWT è‡ªåŠ¨æ³¨å…¥
- [ ] æ”¯æŒè¯·æ±‚å–æ¶ˆï¼ˆAbortControllerï¼‰
- [ ] ç»Ÿä¸€é”™è¯¯å¤„ç†
- [ ] æ”¯æŒ SSE æµå¼è¯·æ±‚
- [ ] é”™è¯¯å¤„ç†å™¨æ­£å¸¸å·¥ä½œ

---

### 5.5 Service å±‚å°è£…

**ç›®æ ‡**: å°è£… Supabase è°ƒç”¨ï¼Œæ”¯æŒæœªæ¥åˆ‡æ¢åˆ° BFF

**æ­¥éª¤ 1: åˆ›å»º Case Service**

```bash
touch src/features/case/services/caseService.js
```

**æ­¥éª¤ 2: å®ç°åŒæ¨¡å¼åˆ‡æ¢**

```javascript
// æ”¯æŒç¯å¢ƒå˜é‡åˆ‡æ¢
const USE_BFF = import.meta.env.VITE_USE_BFF === 'true'

export const caseService = {
  async getById(id) {
    if (USE_BFF) {
      return apiClient.get(`/api/v1/cases/${id}`)
    } else {
      // Supabase è°ƒç”¨
    }
  }
}
```

**éªŒæ”¶æ ‡å‡†**:

- [ ] Service å±‚å°è£…å®Œæˆ
- [ ] æ”¯æŒç¯å¢ƒå˜é‡åˆ‡æ¢
- [ ] ç»„ä»¶è°ƒç”¨ Service è€Œéç›´æ¥è°ƒç”¨ Supabase
- [ ] åŠŸèƒ½å®Œå…¨æ­£å¸¸

---

## 6. é—®é¢˜è¿½è¸ª

### 6.1 å½“å‰é—®é¢˜

| ID  | é—®é¢˜æè¿°                 | ä¼˜å…ˆçº§ | çŠ¶æ€      | è´Ÿè´£äºº | é¢„è®¡ä¿®å¤æ—¶é—´ |
| --- | ------------------------ | ------ | --------- | ------ | ------------ |
| #1  | æ³•å¾‹æ£€ç´¢å†å²è®°å½•æ— æ³•æ‰“å¼€ | P0     | ğŸ”„ å¾…ä¿®å¤ | -      | 0.5 å¤©       |
| #2  | éƒ¨åˆ†æ–‡ä»¶ä»ä½¿ç”¨æ—§å¯¼å…¥è·¯å¾„ | P1     | ğŸ”„ å¾…ä¿®å¤ | -      | 0.5 å¤©       |

### 6.2 å·²è§£å†³é—®é¢˜

| ID  | é—®é¢˜æè¿°                       | è§£å†³æ—¶é—´   | è§£å†³æ–¹æ¡ˆ                               |
| --- | ------------------------------ | ---------- | -------------------------------------- |
| #0  | router.js å¯¼å…¥é”™è¯¯             | 2026-01-04 | æ›´æ–°æ‰€æœ‰å¯¼å…¥è·¯å¾„ä¸º `@/router/index.js` |
| #-1 | authStore è®¿é—®é”™è¯¯             | 2026-01-04 | ç»Ÿä¸€ä½¿ç”¨ `authStore.state.user`        |
| #-2 | Sidebar.vue äº‹ä»¶å¤„ç†å™¨è¯­æ³•é”™è¯¯ | 2026-01-04 | æ”¹ä¸ºæ–¹æ³•è°ƒç”¨ `openFeedback()`          |

---

## 7. æ£€æŸ¥æ¸…å•

### 7.1 Phase 1: åŸºç¡€è®¾æ–½ âœ…

- [x] è·¯ç”±ç³»ç»Ÿé‡æ„å®Œæˆ
- [x] å¸ƒå±€ç³»ç»Ÿåˆ›å»ºå®Œæˆ
- [x] è·¯å¾„åˆ«åé…ç½®å®Œæˆ
- [x] Store ç³»ç»Ÿåˆ›å»ºå®Œæˆ
- [x] æ‰€æœ‰å¯¼å…¥è·¯å¾„æ›´æ–°å®Œæˆ

### 7.2 Phase 2: Auth è¯•ç‚¹ âœ…

- [x] Auth Store åˆ›å»ºå®Œæˆ
- [x] è®¤è¯ç›¸å…³è§†å›¾æ›´æ–°å®Œæˆ
- [x] è·¯ç”±å®ˆå«æ­£å¸¸å·¥ä½œ

### 7.3 Phase 3: Case æ ¸å¿ƒ âœ…

- [x] CaseDetail.js ä¼˜åŒ–å®Œæˆ
- [x] ç›®å½•ç»“æ„è¿ç§»å®Œæˆ
- [x] è·¯ç”±é…ç½®æ›´æ–°å®Œæˆ
- [x] System æ¨¡å— SFC åŒ– (Settings, ProductFeedback, UserProfile)
- [x] Legal Research æ¨¡å— SFC åŒ– (LegalResearch)
- [x] Case å­æ¨¡å— SFC åŒ– (6 ä¸ªç»„ä»¶)
- [x] Composables æŠ½å– (useCaseData, useModal, useStakeholders, useTags)
- [x] Composables åº”ç”¨åˆ°ç»„ä»¶ (å…¨éƒ¨å®Œæˆ)
- [x] Service å±‚åˆ›å»º (case, financial, stakeholder, ai, evidence)
- [x] API Client å¢å¼º (JWT, SSE, ç¼“å­˜, AbortController)
- [x] æ•°æ®åº“ Schema è¡¥å…¨ (judge, attorney_fee_included, financials å”¯ä¸€çº¦æŸ)
- [x] CaseForm å®Œæ•´åŠŸèƒ½é—­ç¯ (æ˜ å°„ä¿®å¤, éªŒè¯å¢å¼º, ä¿å­˜é€»è¾‘ä¼˜åŒ–)
- [ ] åˆ é™¤åŸå§‹ .js æ–‡ä»¶ (è¿›è¡Œä¸­)

### 7.4 Phase 4: æ¸…ç†ä¸éªŒæ”¶ ğŸ“…

- [ ] åˆ é™¤æ—§æ–‡ä»¶
- [ ] æ›´æ–°æ‰€æœ‰å¯¼å…¥è·¯å¾„
- [ ] è¿è¡Œæµ‹è¯•
- [ ] æ„å»ºéªŒè¯
- [ ] æ–‡æ¡£æ›´æ–°

---

## 8. æ¯æ—¥è¿›åº¦è®°å½•

### 2026-01-04

**å®Œæˆå·¥ä½œ** (ä¸Šåˆ):

- âœ… è·¯ç”±ç³»ç»Ÿé‡æ„ï¼ˆvue-routerï¼‰
- âœ… å¸ƒå±€ç³»ç»Ÿåˆ›å»ºï¼ˆAppLayout, AuthLayoutï¼‰
- âœ… Store ç³»ç»Ÿåˆ›å»ºï¼ˆauth.jsï¼‰
- âœ… CaseDetail.js ä¼˜åŒ–ï¼ˆ1451 â†’ 150 è¡Œï¼‰
- âœ… ä¿®å¤æ‰€æœ‰å¯¼å…¥è·¯å¾„é—®é¢˜

**å®Œæˆå·¥ä½œ** (ä¸‹åˆ):

- âœ… ç›®å½•ç»“æ„è¿ç§»å®Œæˆ (`src/features/`)
- âœ… è·¯ç”±é…ç½®æ›´æ–°å®Œæˆ
- âœ… ä¿®å¤ ContractReview.js æ¨¡æ¿è§£æé”™è¯¯
- âœ… System æ¨¡å— SFC è½¬æ¢:
  - Settings.vue, ProductFeedback.vue, UserProfile.vue
- âœ… Legal Research æ¨¡å— SFC è½¬æ¢:
  - LegalResearch.vue
- âœ… Case å­æ¨¡å— SFC è½¬æ¢ (6 ä¸ª):
  - CaseBasicInfo.vue (583 è¡Œ)
  - CaseFacts.vue (117 è¡Œ)
  - CaseStakeholders.vue (466 è¡Œ)
  - CaseFinancials.vue (293 è¡Œ)
  - CaseEvidence.vue (308 è¡Œ)

### 7.5 M7: BFF å¯¹æ¥å‡†å¤‡ ğŸš€

- [x] API Client å¢å¼º (æ‹¦æˆªå™¨, Token æ³¨å…¥)
- [x] Service å±‚åŒæ¨¡å¼å°è£… (Supabase / BFF)
- [x] SSE æµå¼è¯·æ±‚æ”¯æŒ
- [x] ç»Ÿä¸€é”™è¯¯å¤„ç†æœºåˆ¶
- [x] åç«¯æ¥å£è”è°ƒ (å·²é€šè¿‡ Mock Server éªŒè¯)
  - CaseAdvanced.vue (91 è¡Œ)

**é‡è¦ä¿®å¤**:

- âœ… ä¿®å¤ ContractReview.js ä¸­è¢«æ³¨é‡Šçš„ `<template>` æ ‡ç­¾å¯¼è‡´çš„è§£æé”™è¯¯

**å®Œæˆå·¥ä½œ** (å‚æ™š):

- âœ… Composables æŠ½å–å®Œæˆ:
  - `useCaseData`: æ¡ˆä»¶æ•°æ®ç®¡ç†
  - `useModal`: æ¨¡æ€æ¡†ç®¡ç†
  - `useStakeholders`: å½“äº‹äººç®¡ç†
  - `useTags`: æ ‡ç­¾ç®¡ç†
- âœ… CaseFacts.vue é‡æ„:
  - ä» Options API è¿ç§»åˆ° Compositon API
  - åº”ç”¨ `useCaseData` å’Œ `useModal`
- âœ… CaseBasicInfo.vue é‡æ„:
  - å®Œæ•´è¿ç§»åˆ° Composition API
  - é›†æˆæ‰€æœ‰ 4 ä¸ª Composables

**å®Œæˆå·¥ä½œ** (æ™šä¸Š):

- âœ… æ‰€æœ‰ Case å­æ¨¡å—å®Œæˆ Composition API é‡æ„ä¸ Composable é›†æˆ:
  - `CaseStakeholders.vue`: é›†æˆ `useStakeholders`, `useModal`, `useCaseData`
  - `CaseEvidence.vue`: é›†æˆ `useCaseData`
  - `CaseFinancials.vue`: é›†æˆ `useCaseData`, `useModal`
  - `CaseAdvanced.vue`: é›†æˆ `useCaseData`
- âœ… æ¶æ„é‡æ„æ–‡æ¡£æ›´æ–°

### 2026-01-05

**å®Œæˆå·¥ä½œ** (ä¸Šåˆ):

- âœ… **API Client å°è£…å¢å¼º**: å®ç° `src/services/api-client.js`ï¼Œæ”¯æŒ JWT è‡ªåŠ¨æ³¨å…¥ã€SSE æµå¼è§£æã€è¯·æ±‚ç¼“å­˜å’Œ AbortControllerã€‚
- âœ… **Service å±‚å…¨è¦†ç›–**:
  - `caseService`: å®Œæˆ Supabase æ•°æ®æ˜ å°„ã€‚
  - `financialService`: æ”¯æŒè´¢åŠ¡æ•°æ® upsert å’Œå­—æ®µå…¼å®¹ã€‚
  - `stakeholderService`: æ”¯æŒå¤šæ–¹å½“äº‹äººåŠ è½½ä¸ä¿å­˜ã€‚

**å®Œæˆå·¥ä½œ** (ä¸‹åˆ):

- âœ… **CaseForm æ·±åº¦ä¿®å¤**:
  - ä¿®å¤â€œæ‰¿åŠæ³•å®˜ (judge)â€å­—æ®µæ— æ•ˆé—®é¢˜ã€‚
  - ä¿®å¤â€œè´¢åŠ¡ä¿¡æ¯â€ä¿å­˜æ— å“åº”é€»è¾‘ã€‚
  - å®Œå–„å½“äº‹äºº (Stakeholders) è‡ªåŠ¨å›æ˜¾ä¸ä¿å­˜é€»è¾‘ï¼Œé€šè¿‡è¡¨å•éªŒè¯ã€‚
- âœ… **æ•°æ®åº“ Schema è¿ç§»**:
  - `cases` è¡¨æ·»åŠ  `judge` å­—æ®µã€‚
  - `financials` è¡¨æ·»åŠ  `attorney_fee_included` å­—æ®µåŠ `case_id` å”¯ä¸€çº¦æŸã€‚
- âœ… **UX ä½“éªŒæå‡**:
  - ä¸º `CaseForm` æ·»åŠ  `saving` çŠ¶æ€åŠæäº¤æŒ‰é’® Loading æ•ˆæœã€‚
  - ä¿®å¤ `index.html` èµ„æºè·¯å¾„å¯¼è‡´çš„ç™½å±é—®é¢˜ã€‚

**é‡è¦ä¿®å¤**:

- âœ… è§£å†³ `financials` è¡¨å› ç¼ºå°‘å”¯ä¸€çº¦æŸå¯¼è‡´ `upsert` æ“ä½œåœ¨ Supabase ä¸‹é™é»˜å¤±è´¥æˆ–å†²çªæŠ¥é”™çš„é—®é¢˜ã€‚

**å®Œæˆå·¥ä½œ** (æ™šä¸Š):

- âœ… **CaseList äº¤äº’ä¿®å¤**:
  - å½»åº•è§£å†³â€œåˆ é™¤â€å’Œâ€œç»“æ¡ˆâ€æ“ä½œç‚¹å‡»æ— ååº”çš„é—®é¢˜ã€‚
  - å®ç°è‡ªå®šä¹‰ `ConfirmModal` ç»„ä»¶ï¼Œæ›¿ä»£ä¸ç¨³å®šçš„åŸç”Ÿ `alert/confirm`ã€‚
  - é‡æ„ `caseService.delete` é€»è¾‘ï¼Œæ”¯æŒçº§è”åˆ é™¤å…³è”æ•°æ®ã€‚
  - ä¼˜åŒ– Supabase RLS ç­–ç•¥ï¼Œä¿®å¤æƒé™åˆ¤å®šå¯¼è‡´çš„éšå¼æ‹’ç»ã€‚
- âœ… **CaseList æ’åºä¼˜åŒ–**:
  - å®ç°é»˜è®¤æ’åºé€»è¾‘ï¼š`è‰ç¨¿` -> `è¿›è¡Œä¸­` -> `å·²ç»“æ¡ˆ`ã€‚
  - å¢åŠ â€œåŒçŠ¶æ€ä¸‹æŒ‰åˆ›å»ºæ—¶é—´å€’åºâ€çš„äºŒçº§æ’åºè§„åˆ™ã€‚

**ä¸‹ä¸€æ­¥è®¡åˆ’**:

- â³ æ¸…ç† `features/case/views` ä¸‹å¤šä½™çš„ `.js` é€»è¾‘å¤‡ä»½ã€‚
- â³ å¼€å§‹ `contract` (åˆåŒå®¡æŸ¥) å’Œ `document` (æ–‡æ¡£ç”Ÿæˆ) æ¨¡å—çš„ SFC è½¬æ¢ã€‚

---

**æœ€åæ›´æ–°**: 2026-01-05 17:30  
**ä¸‹æ¬¡æ›´æ–°**: 2026-01-06

### 2026-01-06

**å®Œæˆå·¥ä½œ**:

- âœ… **SFC è½¬æ¢å®Œæˆ**:
  - `ContractReview.vue`: åˆåŒå®¡æŸ¥å…¥å£
  - `ContractReviewResult.vue`: å®¡æŸ¥ç»“æœå±•ç¤º
  - `DocGenerate.vue`: æ–‡ä¹¦ç”Ÿæˆå·¥å…·
  - è·¯ç”±é…ç½®æ›´æ–° (`legal-research.js`)
- âœ… **é—ç•™ä»£ç æ¸…ç†**:
  - å½’æ¡£æ—§ JS æ–‡ä»¶åˆ° `src/backup_legacy_code/features/`
  - **(æœ€ç»ˆæ¸…ç†)** åˆ é™¤ `src/backup_legacy_code`
- âœ… **M7 BFF æ¨¡æ‹ŸéªŒè¯**:
  - åˆ›å»º `tools/mock-server` (Express + Supabase JS)
  - éªŒè¯ Proxy Mode (BFF ä»£ç† RLS)
  - æ›´æ–°æ¶æ„æ–‡æ¡£
- âœ… **æœ€ç»ˆéªŒæ”¶**:
  - ç”Ÿäº§æ„å»º (`npm run build`) æˆåŠŸ
  - ç°æœ‰å•å…ƒæµ‹è¯•é€šè¿‡
  - æ‰€æœ‰é‡æ„é‡Œç¨‹ç¢‘è¾¾æˆ

**é¡¹ç›®é‡æ„æ­£å¼ç»“æŸ** ğŸ‰

---

## 9. å‚è€ƒèµ„æ–™

- [æ¶æ„ç¼ºé™·åŠæ”¹è¿›è®¡åˆ’](./æ¶æ„ç¼ºé™·åŠæ”¹è¿›è®¡åˆ’.md)
- [å¾®æœåŠ¡æ²»ç†æ–‡æ¡£](./å¾®æœåŠ¡æ²»ç†æ–‡æ¡£.md)
- [æ¶æ„è®¾è®¡æ–‡æ¡£](./æ¶æ„è®¾è®¡æ–‡æ¡£.md)
- [Vue Router æ–‡æ¡£](https://router.vuejs.org/)

**æœ€åæ›´æ–°**: 2026-01-04 22:00  
**ä¸‹æ¬¡æ›´æ–°**: 2026-01-05
