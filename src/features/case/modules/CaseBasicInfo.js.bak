import CaseModuleLayout from '@/components/case/CaseModuleLayout.js';

/**
 * 案件总览 (基础信息 + 案情 + 当事人)
 */
export default {
    name: 'CaseBasicInfo',
    components: {
        CaseModuleLayout
    },
    data() {
        return {
            caseId: '',
            caseData: {},
            // 基础信息配置
            stageOptions: ['咨询', '立案', '一审', '二审', '再审', '执行', '结案'],
            statusOptions: [
                { code: 'draft', text: '草稿', color: '#f3f4f6', textColor: '#4b5563' },
                { code: 'active', text: '进行中', color: '#dcfce7', textColor: '#15803d' },
                { code: 'closed', text: '已结案', color: '#fee2e2', textColor: '#b91c1c' }
            ],

            // 案情描述数据 (Mock)
            factsData: {
                description: '2023年3月，原告张某与被告某科技有限公司签订软件开发合同，约定开发费用100万元。项目于2023年9月完成并交付，被告已支付50万元，剩余50万元尾款迟迟未支付。多次催款无果后，原告诉至法院。',
                disputeFocus: ['软件是否已实际交付', '质量验收是否合格', '违约损失金额'],
                objective: '支付剩余款项50万元 + 违约金8万元 + 利息'
            },
            // 预设争议焦点选项
            commonFocusOptions: [
                '合同效力', '违约责任', '赔偿金额', '交付标准', '工期延误', '质量异议', '付款条件', '解除合同'
            ],
            newFocusInput: '',

            // 当事人数据 (Mock)
            stakeholders: {
                plaintiffs: [
                    {
                        id: 1,
                        name: '张三',
                        type: 'person',
                        idNumber: '110101198001011234',
                        phone: '13800138000',
                        address: '北京市朝阳区某某街道123号',
                        role: '原告',
                        contactName: '王经理',
                        contactRole: '主要联络人',
                        contactPhone: '138-0000-1234',
                        contactEmail: 'wang@abc.com'
                    }
                ],
                defendants: [
                    {
                        id: 1,
                        name: '某科技有限公司',
                        type: 'company',
                        legalRepresentative: '李四',
                        creditCode: '91110000MA01A2B3C4',
                        address: '北京市海淀区某某大厦10层',
                        lawyer: '王律师（某律所）',
                        role: '被告',
                        contactName: '',
                        contactRole: '',
                        contactPhone: '',
                        contactEmail: ''
                    }
                ],
                thirdParties: []
            },

            // Modals & Forms
            showBasicInfoModal: false,
            showCaseFactsModal: false,
            showStakeholderModal: false,
            editForm: {},

            // 当事人编辑相关
            currentStakeholder: null,
            stakeholderType: 'plaintiff'
        };
    },
    created() {
        const hash = window.location.hash;
        const match = hash.match(/\/detail\/([^/]+)/);
        this.caseId = match ? match[1] : '1';
    },
    methods: {
        // --- 通用 ---
        onCaseLoaded(data) {
            this.caseData = data;
        },

        // --- 基础信息逻辑 ---
        editBasicInfo() {
            this.editForm = {
                name: this.caseData.name,
                id: this.caseData.id,
                type: this.caseData.type,
                category: this.caseData.category,
                court: this.caseData.court || '',
                filingDate: this.caseData.filingDate || '',
                stage: this.caseData.stage || '咨询'
            };
            this.showBasicInfoModal = true;
        },
        saveBasicInfo() {
            Object.assign(this.caseData, {
                name: this.editForm.name,
                id: this.editForm.id,
                type: this.editForm.type,
                category: this.editForm.category,
                court: this.editForm.court,
                filingDate: this.editForm.filingDate,
                stage: this.editForm.stage
            });
            this.showBasicInfoModal = false;
        },

        // --- 案情描述逻辑 ---
        editCaseFacts() {
            this.editForm = {
                description: this.factsData.description,
                disputeFocus: JSON.parse(JSON.stringify(this.factsData.disputeFocus)), // Deep copy array
                objective: this.factsData.objective
            };
            this.newFocusInput = ''; // Reset input
            this.showCaseFactsModal = true;
        },
        saveCaseFacts() {
            this.factsData.description = this.editForm.description;
            this.factsData.disputeFocus = this.editForm.disputeFocus; // Array assignment
            this.factsData.objective = this.editForm.objective;
            this.showCaseFactsModal = false;
        },
        addFocusTag() {
            const val = this.newFocusInput.trim();
            if (val && !this.editForm.disputeFocus.includes(val)) {
                this.editForm.disputeFocus.push(val);
            }
            this.newFocusInput = '';
        },
        removeFocusTag(index) {
            this.editForm.disputeFocus.splice(index, 1);
        },
        addCommonFocus(focus) {
            if (!this.editForm.disputeFocus.includes(focus)) {
                this.editForm.disputeFocus.push(focus);
            }
        },

        // --- 当事人逻辑 ---
        addStakeholder(type) {
            this.stakeholderType = type;
            this.currentStakeholder = {
                id: null,
                name: '',
                type: 'person',
                idNumber: '',
                phone: '',
                address: '',
                role: type === 'plaintiff' ? '原告' : (type === 'defendant' ? '被告' : '第三人'),
                legalRepresentative: '', creditCode: '', lawyer: '',
                contactName: '', contactRole: '', contactPhone: '', contactEmail: ''
            };
            this.showStakeholderModal = true;
        },
        editStakeholder(type, stakeholder) {
            this.stakeholderType = type;
            this.currentStakeholder = JSON.parse(JSON.stringify(stakeholder));
            this.showStakeholderModal = true;
        },
        deleteStakeholder(type, id) {
            if (!confirm('确定要删除该当事人吗？')) return;
            const listName = type === 'plaintiff' ? 'plaintiffs' : (type === 'defendant' ? 'defendants' : 'thirdParties');
            this.stakeholders[listName] = this.stakeholders[listName].filter(item => item.id !== id);
        },
        saveStakeholder() {
            if (!this.currentStakeholder.name) {
                alert('请输入姓名/名称');
                return;
            }
            const listName = this.stakeholderType === 'plaintiff' ? 'plaintiffs' : (this.stakeholderType === 'defendant' ? 'defendants' : 'thirdParties');

            if (this.currentStakeholder.id) {
                const index = this.stakeholders[listName].findIndex(item => item.id === this.currentStakeholder.id);
                if (index !== -1) {
                    this.stakeholders[listName].splice(index, 1, this.currentStakeholder);
                }
            } else {
                this.currentStakeholder.id = Date.now();
                this.stakeholders[listName].push(this.currentStakeholder);
            }
            this.showStakeholderModal = false;
        },

        // --- 工具方法 ---
        getStakeholderSummary(s) {
            const parts = [];
            if (s.idNumber) parts.push(`身份证: ${s.idNumber}`);
            if (s.creditCode) parts.push(`信用代码: ${s.creditCode}`);
            if (s.legalRepresentative) parts.push(`法定代表人: ${s.legalRepresentative}`);
            if (s.phone) parts.push(`电话: ${s.phone}`);
            return parts.join(' | ');
        },

        getStatusStyle(code) {
            const option = this.statusOptions.find(o => o.code === (code || 'active'));
            if (option) {
                return {
                    backgroundColor: option.color,
                    color: option.textColor
                };
            }
            return {};
        }
    },
    template: `
        <CaseModuleLayout :case-id="caseId" active-module="basic" @case-loaded="onCaseLoaded">
            <div class="tab-pane">
                
                <!-- 顶部双栏容器 (基础信息 + 案情描述) -->
                <div style="display: grid; grid-template-columns: 450px 1fr; gap: 24px; margin-bottom: 24px;">
                    
                    <!-- 1. 左侧：基础信息 (2列布局) -->
                    <div class="modern-card" style="height: 100%;">
                        <div class="card-header" style="background: transparent;">
                            <div class="card-title">案件总览</div>
                            <button class="icon-btn" style="font-size: 14px;" @click="editBasicInfo">
                                <i class="fas fa-pen"></i>
                            </button>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px 20px;">
                            <div class="info-row" style="grid-column: span 2;">
                                <span class="label">案件标题</span>
                                <span class="value">{{ caseData.name }}</span>
                            </div>
                            <div class="info-row">
                                <span class="label">案件编号</span>
                                <span class="value">{{ caseData.id }}</span>
                            </div>
                            <div class="info-row">
                                <span class="label">案件状态</span>
                                <span class="value">
                                    <span 
                                        class="tag" 
                                        :style="getStatusStyle(caseData.statusCode)"
                                        style="margin: 0;"
                                    >
                                        {{ caseData.status }}
                                    </span>
                                </span>
                            </div>
                            
                            <div class="info-row">
                                <span class="label">案由</span>
                                <span class="value">{{ caseData.type }}</span>
                            </div>
                            <div class="info-row">
                                <span class="label">案件阶段</span>
                                <span class="value">{{ caseData.stage || '-' }}</span>
                            </div>
                             <div class="info-row">
                                <span class="label">管辖法院</span>
                                <span class="value">{{ caseData.court || '-' }}</span>
                            </div>
                            <div class="info-row">
                                <span class="label">负责人</span>
                                <span class="value">{{ caseData.assignee }}</span>
                            </div>
                            <div class="info-row">
                                <span class="label">立案日期</span>
                                <span class="value">{{ caseData.filingDate || '-' }}</span>
                            </div>
                             <div class="info-row">
                                <span class="label">最后更新</span>
                                <span class="value">{{ caseData.lastUpdate }}</span>
                            </div>

                            <div class="info-row" style="grid-column: span 2;">
                                <span class="label">诉讼时效/上诉截止日</span>
                                <span class="value" style="color: #dc2626; font-weight: 500;">{{ caseData.deadline || '-' }}</span>
                            </div>
                        </div>
                    </div>

                    <!-- 2. 右侧：案情描述 (高度自适应) -->
                    <div class="modern-card" style="height: 100%;">
                        <div class="card-header" style="background: transparent;">
                            <div class="card-title">案情描述</div>
                            <button class="icon-btn" style="font-size: 14px;" @click="editCaseFacts">
                                <i class="fas fa-pen"></i>
                            </button>
                        </div>
                        <div style="background: #f8fafc; padding: 16px; border-radius: 8px; margin-bottom: 16px;">
                            <p style="margin: 0; color: #334155; line-height: 1.8; font-size: 14px; text-align: justify;">
                                {{ factsData.description }}
                            </p>
                        </div>
                        <div class="info-row" style="display: block; margin-bottom: 16px;">
                            <span class="label">争议焦点</span>
                            <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 8px;">
                                <span v-for="(focus, index) in factsData.disputeFocus" :key="index" class="tag" style="background: #e0e7ff; color: #4f46e5; padding: 4px 10px; border-radius: 6px; font-size: 13px;">
                                    {{ focus }}
                                </span>
                            </div>
                        </div>
                        <div class="info-row">
                            <span class="label">客户诉求</span>
                            <span class="value">{{ factsData.objective }}</span>
                        </div>
                    </div>
                </div>

                <!-- 3. 底部：当事人信息 (列表式) -->
                <div class="modern-card" style="margin-bottom: 24px;">
                    <div class="card-header" style="background: transparent; border-bottom: 1px solid #f1f5f9; padding-bottom: 12px; margin-bottom: 12px;">
                        <div class="card-title">当事人信息</div>
                        <div style="display: flex; gap: 8px;">
                            <button class="smart-btn-secondary" style="font-size: 12px; padding: 4px 10px;" @click="addStakeholder('plaintiff')">
                                <i class="fas fa-plus"></i> 原告
                            </button>
                            <button class="smart-btn-secondary" style="font-size: 12px; padding: 4px 10px;" @click="addStakeholder('defendant')">
                                <i class="fas fa-plus"></i> 被告
                            </button>
                             <button class="smart-btn-secondary" style="font-size: 12px; padding: 4px 10px;" @click="addStakeholder('thirdParty')">
                                <i class="fas fa-plus"></i> 第三人
                            </button>
                        </div>
                    </div>

                    <div style="display: flex; flex-direction: column; gap: 24px;">
                        
                        <!-- 原告列表 -->
                        <div>
                            <div style="font-size: 13px; font-weight: 600; color: #64748b; margin-bottom: 12px; display: flex; align-items: center;">
                                <span style="display: inline-block; width: 4px; height: 14px; background: #4f46e5; margin-right: 8px; border-radius: 2px;"></span>
                                原告 ({{ stakeholders.plaintiffs.length }})
                            </div>
                            <div style="display: flex; flex-direction: column; gap: 8px;">
                                <div v-for="item in stakeholders.plaintiffs" :key="item.id" 
                                     style="display: flex; flex-direction: column; padding: 12px 16px; background: #fff; border: 1px solid #e2e8f0; border-radius: 8px; transition: all 0.2s;">
                                    <div style="display: flex; align-items: center; justify-content: space-between;">
                                        <div style="display: flex; align-items: center; gap: 12px;">
                                            <div style="width: 32px; height: 32px; background: #eef2ff; color: #4f46e5; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px;">
                                                <i class="fas" :class="item.type === 'person' ? 'fa-user' : 'fa-building'"></i>
                                            </div>
                                            <div>
                                                <div style="font-weight: 600; color: #1e293b; font-size: 14px;">{{ item.name }}</div>
                                                <div style="font-size: 12px; color: #64748b; margin-top: 2px;">{{ getStakeholderSummary(item) }}</div>
                                            </div>
                                        </div>
                                        <div style="display: flex; gap: 8px;">
                                            <button class="icon-btn" @click="editStakeholder('plaintiff', item)"><i class="fas fa-edit"></i></button>
                                            <button class="icon-btn" style="color: #ef4444;" @click="deleteStakeholder('plaintiff', item.id)"><i class="fas fa-trash-alt"></i></button>
                                        </div>
                                    </div>
                                    <div v-if="item.contactName" style="margin-top: 8px; padding-top: 8px; border-top: 1px dashed #f1f5f9; font-size: 13px; color: #64748b; display: flex; flex-wrap: wrap; gap: 16px;">
                                        <span><i class="fas fa-user-tie" style="margin-right: 6px; color: #94a3b8;"></i>{{ item.contactName }} <span v-if="item.contactRole">({{ item.contactRole }})</span></span>
                                        <span v-if="item.contactPhone"><i class="fas fa-phone-alt" style="margin-right: 6px; color: #94a3b8;"></i>{{ item.contactPhone }}</span>
                                        <span v-if="item.contactEmail"><i class="fas fa-envelope" style="margin-right: 6px; color: #94a3b8;"></i>{{ item.contactEmail }}</span>
                                    </div>
                                </div>
                                <div v-if="stakeholders.plaintiffs.length === 0" style="padding: 12px; text-align: center; color: #94a3b8; font-size: 13px; border: 1px dashed #e2e8f0; border-radius: 8px;">暂无原告信息</div>
                            </div>
                        </div>

                         <!-- 被告列表 -->
                        <div>
                            <div style="font-size: 13px; font-weight: 600; color: #64748b; margin-bottom: 12px; display: flex; align-items: center;">
                                <span style="display: inline-block; width: 4px; height: 14px; background: #dc2626; margin-right: 8px; border-radius: 2px;"></span>
                                被告 ({{ stakeholders.defendants.length }})
                            </div>
                            <div style="display: flex; flex-direction: column; gap: 8px;">
                                <div v-for="item in stakeholders.defendants" :key="item.id" 
                                     style="display: flex; flex-direction: column; padding: 12px 16px; background: #fff; border: 1px solid #e2e8f0; border-radius: 8px; transition: all 0.2s;">
                                    <div style="display: flex; align-items: center; justify-content: space-between;">
                                        <div style="display: flex; align-items: center; gap: 12px;">
                                            <div style="width: 32px; height: 32px; background: #fef2f2; color: #dc2626; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px;">
                                                <i class="fas" :class="item.type === 'person' ? 'fa-user' : 'fa-building'"></i>
                                            </div>
                                            <div>
                                                <div style="font-weight: 600; color: #1e293b; font-size: 14px;">{{ item.name }}</div>
                                                <div style="font-size: 12px; color: #64748b; margin-top: 2px;">{{ getStakeholderSummary(item) }}</div>
                                            </div>
                                        </div>
                                        <div style="display: flex; gap: 8px;">
                                            <button class="icon-btn" @click="editStakeholder('defendant', item)"><i class="fas fa-edit"></i></button>
                                            <button class="icon-btn" style="color: #ef4444;" @click="deleteStakeholder('defendant', item.id)"><i class="fas fa-trash-alt"></i></button>
                                        </div>
                                    </div>
                                    <div v-if="item.contactName" style="margin-top: 8px; padding-top: 8px; border-top: 1px dashed #f1f5f9; font-size: 13px; color: #64748b; display: flex; flex-wrap: wrap; gap: 16px;">
                                        <span><i class="fas fa-user-tie" style="margin-right: 6px; color: #94a3b8;"></i>{{ item.contactName }} <span v-if="item.contactRole">({{ item.contactRole }})</span></span>
                                        <span v-if="item.contactPhone"><i class="fas fa-phone-alt" style="margin-right: 6px; color: #94a3b8;"></i>{{ item.contactPhone }}</span>
                                        <span v-if="item.contactEmail"><i class="fas fa-envelope" style="margin-right: 6px; color: #94a3b8;"></i>{{ item.contactEmail }}</span>
                                    </div>
                                </div>
                                <div v-if="stakeholders.defendants.length === 0" style="padding: 12px; text-align: center; color: #94a3b8; font-size: 13px; border: 1px dashed #e2e8f0; border-radius: 8px;">暂无被告信息</div>
                            </div>
                        </div>

                        <!-- 第三人列表 -->
                         <div v-if="stakeholders.thirdParties.length > 0">
                            <div style="font-size: 13px; font-weight: 600; color: #64748b; margin-bottom: 12px; display: flex; align-items: center;">
                                <span style="display: inline-block; width: 4px; height: 14px; background: #d97706; margin-right: 8px; border-radius: 2px;"></span>
                                第三人 ({{ stakeholders.thirdParties.length }})
                            </div>
                            <div style="display: flex; flex-direction: column; gap: 8px;">
                                <div v-for="item in stakeholders.thirdParties" :key="item.id" 
                                     style="display: flex; flex-direction: column; padding: 12px 16px; background: #fff; border: 1px solid #e2e8f0; border-radius: 8px; transition: all 0.2s;">
                                    <div style="display: flex; align-items: center; justify-content: space-between;">
                                        <div style="display: flex; align-items: center; gap: 12px;">
                                            <div style="width: 32px; height: 32px; background: #fffbeb; color: #d97706; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px;">
                                                <i class="fas" :class="item.type === 'person' ? 'fa-user' : 'fa-building'"></i>
                                            </div>
                                            <div>
                                                <div style="font-weight: 600; color: #1e293b; font-size: 14px;">{{ item.name }}</div>
                                                <div style="font-size: 12px; color: #64748b; margin-top: 2px;">{{ getStakeholderSummary(item) }}</div>
                                            </div>
                                        </div>
                                        <div style="display: flex; gap: 8px;">
                                            <button class="icon-btn" @click="editStakeholder('thirdParty', item)"><i class="fas fa-edit"></i></button>
                                            <button class="icon-btn" style="color: #ef4444;" @click="deleteStakeholder('thirdParty', item.id)"><i class="fas fa-trash-alt"></i></button>
                                        </div>
                                    </div>
                                    <div v-if="item.contactName" style="margin-top: 8px; padding-top: 8px; border-top: 1px dashed #f1f5f9; font-size: 13px; color: #64748b; display: flex; flex-wrap: wrap; gap: 16px;">
                                        <span><i class="fas fa-user-tie" style="margin-right: 6px; color: #94a3b8;"></i>{{ item.contactName }} <span v-if="item.contactRole">({{ item.contactRole }})</span></span>
                                        <span v-if="item.contactPhone"><i class="fas fa-phone-alt" style="margin-right: 6px; color: #94a3b8;"></i>{{ item.contactPhone }}</span>
                                        <span v-if="item.contactEmail"><i class="fas fa-envelope" style="margin-right: 6px; color: #94a3b8;"></i>{{ item.contactEmail }}</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

            </div>

            <!-- Modals (保持不变) -->
            <!-- 1. Basic Info Modal -->
            <div v-if="showBasicInfoModal" class="modal-overlay" @click.self="showBasicInfoModal = false">
                <div class="modal-container" style="width: 600px;">
                    <div class="modal-header">
                        <div class="modal-title">编辑基础信息</div>
                        <button class="modal-close" @click="showBasicInfoModal = false"><i class="fas fa-times"></i></button>
                    </div>
                    <div class="modal-body">
                         <div class="smart-form-group"><label class="smart-label required">案件名称</label><input type="text" class="smart-input" v-model="editForm.name"></div>
                         <div class="smart-form-group"><label class="smart-label">案件编号</label><input type="text" class="smart-input" v-model="editForm.id"></div>
                         <div class="smart-form-group"><label class="smart-label">案由</label><input type="text" class="smart-input" v-model="editForm.type"></div>
                         <div class="smart-form-group"><label class="smart-label">具体案由</label><input type="text" class="smart-input" v-model="editForm.category"></div>
                         <div class="smart-form-group"><label class="smart-label">管辖法院</label><input type="text" class="smart-input" v-model="editForm.court"></div>
                         <div class="smart-form-group"><label class="smart-label">立案日期</label><input type="date" class="smart-input" v-model="editForm.filingDate"></div>
                         <div class="smart-form-group">
                            <label class="smart-label">案件阶段</label>
                            <select class="smart-select" v-model="editForm.stage">
                                <option v-for="stage in stageOptions" :key="stage" :value="stage">{{ stage }}</option>
                            </select>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="smart-btn-secondary" @click="showBasicInfoModal = false">取消</button>
                        <button class="smart-btn-primary" @click="saveBasicInfo">保存</button>
                    </div>
                </div>
            </div>

            <!-- 2. Facts Modal -->
            <div v-if="showCaseFactsModal" class="modal-overlay" @click.self="showCaseFactsModal = false">
                <div class="modal-container" style="width: 700px;">
                    <div class="modal-header">
                        <div class="modal-title">编辑案情描述</div>
                        <button class="modal-close" @click="showCaseFactsModal = false"><i class="fas fa-times"></i></button>
                    </div>
                    <div class="modal-body">
                        <div class="smart-form-group">
                            <label class="smart-label">案情摘要</label>
                            <textarea class="smart-textarea" v-model="editForm.description" rows="6" style="border: 1px solid #e2e8f0; border-radius: 6px; padding: 8px;"></textarea>
                        </div>
                        <div class="smart-form-group">
                            <label class="smart-label">争议焦点 (回车添加)</label>
                            
                            <!-- 标签输入区域 -->
                            <div style="border: 1px solid #e2e8f0; border-radius: 6px; padding: 4px 8px; min-height: 40px; display: flex; flex-wrap: wrap; gap: 8px; background: #fff; align-items: center;">
                                <!-- 已选标签 -->
                                <span v-for="(focus, index) in editForm.disputeFocus" :key="index" 
                                      class="tag" style="background: #e0e7ff; color: #4f46e5; margin: 0; padding: 4px 10px; border-radius: 16px; display: flex; align-items: center; gap: 6px;">
                                    {{ focus }}
                                    <i class="fas fa-times" style="cursor: pointer; opacity: 0.6;" @click="removeFocusTag(index)"></i>
                                </span>
                                
                                <!-- 输入框 -->
                                <input 
                                    type="text" 
                                    v-model="newFocusInput" 
                                    placeholder="输入焦点并回车..." 
                                    style="border: none; outline: none; flex: 1; padding: 4px; font-size: 14px; min-width: 120px;"
                                    @keydown.enter.prevent="addFocusTag"
                                    @blur="addFocusTag"
                                >
                            </div>
                            
                            <!-- 常用选项 -->
                            <div style="margin-top: 8px; font-size: 12px; color: #64748b;">
                                推荐标签：
                                <span v-for="opt in commonFocusOptions" :key="opt" 
                                      style="cursor: pointer; margin-right: 8px; display: inline-block; padding: 2px 8px; background: #f1f5f9; border-radius: 12px; margin-bottom: 4px;"
                                      @click="addCommonFocus(opt)">
                                    + {{ opt }}
                                </span>
                            </div>
                        </div>
                        <div class="smart-form-group">
                            <label class="smart-label">客户诉求</label>
                            <textarea class="smart-textarea" v-model="editForm.objective" rows="3" style="border: 1px solid #e2e8f0; border-radius: 6px; padding: 8px;"></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="smart-btn-secondary" @click="showCaseFactsModal = false">取消</button>
                        <button class="smart-btn-primary" @click="saveCaseFacts">保存</button>
                    </div>
                </div>
            </div>

            <!-- 3. Stakeholder Modal -->
            <div v-if="showStakeholderModal" class="modal-overlay" @click.self="showStakeholderModal = false">
                <div class="modal-container" style="width: 600px;">
                    <div class="modal-header">
                        <div class="modal-title">{{ currentStakeholder.id ? '编辑' : '添加' }}{{ currentStakeholder.role }}</div>
                        <button class="modal-close" @click="showStakeholderModal = false"><i class="fas fa-times"></i></button>
                    </div>
                    <div class="modal-body">
                         <div class="smart-form-group">
                            <label class="smart-label">主体类型</label>
                            <div style="display: flex; gap: 16px;">
                                <label><input type="radio" v-model="currentStakeholder.type" value="person"> 自然人</label>
                                <label><input type="radio" v-model="currentStakeholder.type" value="company"> 法人/组织</label>
                            </div>
                        </div>
                        <div class="smart-form-group">
                            <label class="smart-label required">姓名/名称</label>
                            <input type="text" class="smart-input" v-model="currentStakeholder.name">
                        </div>
                        <template v-if="currentStakeholder.type === 'person'">
                            <div class="smart-form-group"><label class="smart-label">身份证号</label><input type="text" class="smart-input" v-model="currentStakeholder.idNumber"></div>
                             <div class="smart-form-group"><label class="smart-label">电话</label><input type="text" class="smart-input" v-model="currentStakeholder.phone"></div>
                        </template>
                        <template v-if="currentStakeholder.type === 'company'">
                             <div class="smart-form-group"><label class="smart-label">信用代码</label><input type="text" class="smart-input" v-model="currentStakeholder.creditCode"></div>
                             <div class="smart-form-group"><label class="smart-label">法定代表人</label><input type="text" class="smart-input" v-model="currentStakeholder.legalRepresentative"></div>
                        </template>

                        <!-- 联络人信息 (新增) -->
                        <div style="margin-top: 16px; border-top: 1px dashed #e2e8f0; padding-top: 16px;">
                            <div style="font-size: 13px; font-weight: 600; color: #64748b; margin-bottom: 12px;">联络人信息</div>
                            <div class="smart-form-group">
                                <label class="smart-label">联络人姓名</label>
                                <div style="display: flex; gap: 12px;">
                                    <input type="text" class="smart-input" v-model="currentStakeholder.contactName" placeholder="姓名" style="flex: 1;">
                                    <input type="text" class="smart-input" v-model="currentStakeholder.contactRole" placeholder="职位/角色 (选填)" style="width: 140px;">
                                </div>
                            </div>
                            <div class="smart-form-group">
                                <label class="smart-label">联系方式</label>
                                <div style="display: flex; gap: 12px;">
                                    <input type="text" class="smart-input" v-model="currentStakeholder.contactPhone" placeholder="电话号码" style="flex: 1;">
                                    <input type="text" class="smart-input" v-model="currentStakeholder.contactEmail" placeholder="电子邮箱" style="flex: 1;">
                                </div>
                            </div>
                        </div>
                    </div>
                     <div class="modal-footer">
                        <button class="smart-btn-secondary" @click="showStakeholderModal = false">取消</button>
                        <button class="smart-btn-primary" @click="saveStakeholder">保存</button>
                    </div>
                </div>
            </div>

        </CaseModuleLayout>
    `
};
